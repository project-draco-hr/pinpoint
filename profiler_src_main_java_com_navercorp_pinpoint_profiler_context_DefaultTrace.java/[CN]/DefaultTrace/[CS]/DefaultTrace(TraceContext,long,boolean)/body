{
  if (traceContext == null) {
    throw new NullPointerException("traceContext must not be null");
  }
  this.traceContext=traceContext;
  this.traceId=new DefaultTraceId(traceContext.getAgentId(),traceContext.getAgentStartTime(),transactionId);
  this.sampling=sampling;
  this.traceId.incrementTraceCount();
  Span span=createSpan();
  this.spanRecorder=new DefaultSpanRecorder(traceContext,span,traceId,sampling);
  this.spanRecorder.recordTraceId(traceId);
  this.spanEventRecorder=new WrappedSpanEventRecorder(traceContext);
  if (traceContext.getProfilerConfig() != null) {
    final int maxCallStackDepth=traceContext.getProfilerConfig().getCallStackMaxDepth();
    this.callStack=new CallStack(span,maxCallStackDepth);
  }
 else {
    this.callStack=new CallStack(span);
  }
}
