{
  logger.info("AgentCheckTimerTask started.");
  try {
    List<AgentInfo> agentInfoList=agentService.getRecentAgentInfoList(applicationName);
    for (    AgentInfo agentInfo : agentInfoList) {
      String agentId=agentInfo.getAgentId();
      if (defaultAgentIdList.contains(agentId)) {
        continue;
      }
      AgentStatus agentStatus=agentInfo.getStatus();
      if (agentStatus != null && agentStatus.getState() != AgentLifeCycleState.UNKNOWN) {
        responseAggregator.addActiveWorker(agentInfo);
        defaultAgentIdList.add(agentId);
      }
 else       if (agentService.isConnected(agentInfo)) {
        responseAggregator.addActiveWorker(agentInfo);
        defaultAgentIdList.add(agentId);
      }
    }
  }
  finally {
    if (timer != null && onAgentCheckTimerTask.get() && !isStopped.get()) {
      timer.schedule(new AgentCheckTimerTask(),DEFAULT_AGENT_CHECk_DELAY);
    }
  }
}
