{
  if (depth < MIN_DEPTH || depth == ROOT_DEPTH) {
    throw new IllegalArgumentException("invalid depth. depth=" + depth + ", node="+ last);
  }
  if (depth == LEVEL_DEPTH || depth == last.getDepth()) {
    if (last.isRoot() || last.hasSibling()) {
      throw new IllegalArgumentException("invalid depth. depth=" + depth + ", node="+ last);
    }
    last.setSibling(spanAlign);
    last=last.getSibling();
    return;
  }
  if (depth > last.getDepth()) {
    if (depth > last.getDepth() + 1 || last.hasChild()) {
      throw new IllegalArgumentException("invalid depth. depth=" + depth + ", node="+ last);
    }
    last.setChild(spanAlign);
    last=last.getChild();
    return;
  }
  if (last.getDepth() - depth <= ROOT_DEPTH) {
    throw new IllegalArgumentException("invalid depth. depth=" + depth + ", node="+ last);
  }
  final CallTreeNode node=findUpperLevelLastSibling(depth,last);
  node.setSibling(spanAlign);
  last=node.getSibling();
}
