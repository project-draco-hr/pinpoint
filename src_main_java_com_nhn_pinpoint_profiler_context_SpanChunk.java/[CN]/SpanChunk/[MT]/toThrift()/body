{
  final List<TSpanEvent> spanEventList=getSpanEventList();
  TSpanEvent first=spanEventList.get(0);
  if (first == null) {
    throw new IllegalStateException("first spanEvent not found");
  }
  Span parentSpan=((SpanEvent)first).getSpan();
  final AgentInformation agentInformation=DefaultAgent.getInstance().getAgentInformation();
  final String agentId=agentInformation.getAgentId();
  this.setAgentId(agentId);
  this.setApplicationName(agentInformation.getApplicationName());
  this.setAgentStartTime(agentInformation.getStartTime());
  this.setServiceType(parentSpan.getServiceType());
  final String traceAgentId=parentSpan.getTraceAgentId();
  if (!agentId.equals(traceAgentId)) {
    this.setTraceAgentId(traceAgentId);
  }
  this.setTraceAgentStartTime(parentSpan.getTraceAgentStartTime());
  this.setTraceTransactionSequence(parentSpan.getTraceTransactionSequence());
  this.setSpanId(parentSpan.getSpanId());
  this.setEndPoint(parentSpan.getEndPoint());
  return this;
}
