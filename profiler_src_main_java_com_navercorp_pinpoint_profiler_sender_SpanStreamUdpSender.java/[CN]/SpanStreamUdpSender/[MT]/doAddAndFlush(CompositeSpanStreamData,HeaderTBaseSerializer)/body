{
  logger.debug("CompositeSpanStreamData {}.",compositeSpanStreamData);
  SpanStreamSendData currentSpanStreamSendData=standbySpanStreamDataSendWorker.getStandbySpanStreamSendData();
  if (currentSpanStreamSendData == null) {
    currentSpanStreamSendData=spanStreamSendDataFactory.create();
  }
  try {
    if (!currentSpanStreamSendData.addBuffer(compositeSpanStreamData.getByteBuffer())) {
      SendDataPlaner sendDataPlaner=new SpanChunkStreamSendDataPlaner(compositeSpanStreamData,spanStreamSendDataFactory);
      Iterator<SpanStreamSendData> sendDataIterator=sendDataPlaner.getSendDataIterator(currentSpanStreamSendData,serializer);
      while (sendDataIterator.hasNext()) {
        SpanStreamSendData sendData=sendDataIterator.next();
        if (sendData.getFlushMode() == SpanStreamSendDataMode.FLUSH) {
          flush(sendData);
        }
 else         if (sendData.getFlushMode() == SpanStreamSendDataMode.WAIT_BUFFER) {
          boolean isAdded=standbySpanStreamDataSendWorker.addStandbySpanStreamData(sendData);
          if (!isAdded) {
            flush(sendData);
          }
        }
      }
    }
 else {
      standbySpanStreamDataSendWorker.addStandbySpanStreamData(currentSpanStreamSendData);
    }
  }
 catch (  IOException e) {
    logger.warn("UDPChannel write fail.",e);
  }
}
