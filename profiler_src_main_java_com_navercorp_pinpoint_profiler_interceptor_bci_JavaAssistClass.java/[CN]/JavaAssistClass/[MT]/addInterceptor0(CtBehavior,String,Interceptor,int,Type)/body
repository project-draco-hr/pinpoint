{
  try {
    if (interceptor != null) {
      if (interceptor instanceof StaticAroundInterceptor) {
        StaticAroundInterceptor staticAroundInterceptor=(StaticAroundInterceptor)interceptor;
        interceptorId=InterceptorRegistry.addInterceptor(staticAroundInterceptor);
      }
 else       if (interceptor instanceof SimpleAroundInterceptor) {
        SimpleAroundInterceptor simpleAroundInterceptor=(SimpleAroundInterceptor)interceptor;
        interceptorId=InterceptorRegistry.addSimpleInterceptor(simpleAroundInterceptor);
      }
 else {
        throw new InstrumentException("unsupported Interceptor Type:" + interceptor);
      }
      injectInterceptor(behavior,interceptor);
    }
 else {
      interceptor=InterceptorRegistry.findInterceptor(interceptorId);
    }
    if (interceptor instanceof StaticAroundInterceptor) {
switch (type) {
case around:
        addStaticAroundInterceptor(methodName,interceptorId,behavior);
      break;
case before:
    addStaticBeforeInterceptor(methodName,interceptorId,behavior);
  break;
case after:
addStaticAfterInterceptor(methodName,interceptorId,behavior);
break;
default :
throw new UnsupportedOperationException("unsupport type");
}
}
 else if (interceptor instanceof SimpleAroundInterceptor) {
switch (type) {
case around:
addSimpleAroundInterceptor(methodName,interceptorId,behavior);
break;
case before:
addSimpleBeforeInterceptor(methodName,interceptorId,behavior);
break;
case after:
addSimpleAfterInterceptor(methodName,interceptorId,behavior);
break;
default :
throw new UnsupportedOperationException("unsupport type");
}
}
 else {
throw new IllegalArgumentException("unsupported");
}
return interceptorId;
}
 catch (NotFoundException e) {
throw new InstrumentException(getInterceptorName(interceptor) + " add fail. Cause:" + e.getMessage(),e);
}
catch (CannotCompileException e) {
throw new InstrumentException(getInterceptorName(interceptor) + "add fail. Cause:" + e.getMessage(),e);
}
}
