{
  try {
    if (interceptor != null) {
      if (interceptor instanceof StaticAroundInterceptor) {
        StaticAroundInterceptor staticAroundInterceptor=(StaticAroundInterceptor)interceptor;
        interceptorId=InterceptorRegistry.addInterceptor(staticAroundInterceptor);
      }
 else       if (interceptor instanceof SimpleAroundInterceptor) {
        SimpleAroundInterceptor simpleAroundInterceptor=(SimpleAroundInterceptor)interceptor;
        interceptorId=InterceptorRegistry.addSimpleInterceptor(simpleAroundInterceptor);
      }
 else {
        throw new InstrumentException("unsupported Interceptor Type:" + interceptor);
      }
      if (interceptor instanceof TraceContextSupport) {
        ((TraceContextSupport)interceptor).setTraceContext(instrumentor.getAgent().getTraceContext());
      }
      if (interceptor instanceof ByteCodeMethodDescriptorSupport) {
        setMethodDescriptor(behavior,(ByteCodeMethodDescriptorSupport)interceptor);
      }
    }
 else {
      interceptor=InterceptorRegistry.findInterceptor(interceptorId);
    }
    if (interceptor instanceof StaticAroundInterceptor) {
switch (type) {
case around:
        addStaticAroundInterceptor(methodName,interceptorId,behavior,useContextClassLoader);
      break;
case before:
    addStaticBeforeInterceptor(methodName,interceptorId,behavior,useContextClassLoader);
  break;
case after:
addStaticAfterInterceptor(methodName,interceptorId,behavior,useContextClassLoader);
break;
default :
throw new UnsupportedOperationException("unsupport type");
}
}
 else if (interceptor instanceof SimpleAroundInterceptor) {
switch (type) {
case around:
addSimpleAroundInterceptor(methodName,interceptorId,behavior,useContextClassLoader);
break;
case before:
addSimpleBeforeInterceptor(methodName,interceptorId,behavior,useContextClassLoader);
break;
case after:
addSimpleAfterInterceptor(methodName,interceptorId,behavior,useContextClassLoader);
break;
default :
throw new UnsupportedOperationException("unsupport type");
}
}
 else {
throw new IllegalArgumentException("unsupported");
}
return interceptorId;
}
 catch (NotFoundException e) {
throw new InstrumentException(interceptor.getClass().getSimpleName() + " add fail. Cause:" + e.getMessage(),e);
}
catch (CannotCompileException e) {
throw new InstrumentException(interceptor.getClass().getSimpleName() + "add fail. Cause:" + e.getMessage(),e);
}
}
