{
  logger.info("flush");
  AgentActiveThreadCountList response=new AgentActiveThreadCountList();
synchronized (lock) {
    for (    ActiveThreadCountStreamListener threadCountStreamListener : streamMessageListenerRepository.values()) {
      String agentId=threadCountStreamListener.getAgentInfo().getAgentId();
      AgentActiveThreadCount agentActiveThreadCount=activeThreadCountMap.get(agentId);
      if (agentActiveThreadCount != null) {
        response.add(agentActiveThreadCount);
      }
 else {
        response.add(threadCountStreamListener.getDefaultFailedResponse());
      }
    }
    activeThreadCountMap=new HashMap<String,AgentActiveThreadCount>(streamMessageListenerRepository.size());
  }
  flush0(response);
}
