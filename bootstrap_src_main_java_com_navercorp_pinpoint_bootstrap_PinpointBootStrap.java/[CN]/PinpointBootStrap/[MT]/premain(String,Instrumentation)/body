{
  if (agentArgs != null) {
    logger.info(ProductInfo.CAMEL_NAME + " agentArgs:" + agentArgs);
  }
  final boolean duplicated=checkDuplicateLoadState();
  if (duplicated) {
    logPinpointAgentLoadFail();
    return;
  }
  ClassPathResolver classPathResolver=new ClassPathResolver();
  boolean agentJarNotFound=classPathResolver.findAgentJar();
  if (!agentJarNotFound) {
    logger.severe("pinpoint-bootstrap-x.x.x.jar not found.");
    changeLoadState(BOOT_STRAP_LOAD_STATE_ERROR);
    logPinpointAgentLoadFail();
    return;
  }
  if (!isValidId("pinpoint.agentId",PinpointConstants.AGENT_NAME_MAX_LEN)) {
    changeLoadState(BOOT_STRAP_LOAD_STATE_ERROR);
    logPinpointAgentLoadFail();
    return;
  }
  if (!isValidId("pinpoint.applicationName",PinpointConstants.APPLICATION_NAME_MAX_LEN)) {
    changeLoadState(BOOT_STRAP_LOAD_STATE_ERROR);
    logPinpointAgentLoadFail();
    return;
  }
  String configPath=getConfigPath(classPathResolver);
  if (configPath == null) {
    changeLoadState(BOOT_STRAP_LOAD_STATE_ERROR);
    logPinpointAgentLoadFail();
    return;
  }
  saveLogFilePath(classPathResolver);
  try {
    ProfilerConfig profilerConfig=ProfilerConfig.load(configPath);
    List<URL> libUrlList=resolveLib(classPathResolver);
    AgentClassLoader agentClassLoader=new AgentClassLoader(libUrlList.toArray(new URL[libUrlList.size()]));
    agentClassLoader.setBootClass(BOOT_CLASS);
    logger.info("pinpoint agent start.");
    agentClassLoader.boot(classPathResolver.getAgentDirPath(),agentArgs,instrumentation,profilerConfig);
    logger.info("pinpoint agent start success.");
    changeLoadState(BOOT_STRAP_LOAD_STATE_COMPLETE);
  }
 catch (  Exception e) {
    logger.log(Level.SEVERE,ProductInfo.CAMEL_NAME + " start fail. Caused:" + e.getMessage(),e);
    changeLoadState(BOOT_STRAP_LOAD_STATE_ERROR);
    logPinpointAgentLoadFail();
  }
}
