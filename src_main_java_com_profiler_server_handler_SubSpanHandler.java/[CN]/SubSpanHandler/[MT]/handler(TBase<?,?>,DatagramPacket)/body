{
  try {
    SubSpan subSpan=(SubSpan)tbase;
    if (logger.isInfoEnabled()) {
      logger.info("Received SubSPAN=" + subSpan);
    }
    String applicationName=agentIdApplicationIndexDao.selectApplicationName(subSpan.getAgentId());
    if (applicationName == null) {
      logger.warn("Applicationname '{}' not found. Drop the log.",applicationName);
      return;
    }
 else {
      logger.info("Applicationname '{}' found. Write the log.",applicationName);
    }
    if (logger.isDebugEnabled()) {
      logger.debug("Found Applicationname={}",applicationName);
    }
    ServiceType serviceType=ServiceType.parse(subSpan.getServiceType());
    traceDao.insertTerminalSpan(applicationName,subSpan);
  }
 catch (  Exception e) {
    logger.warn("Span handle error " + e.getMessage(),e);
  }
}
