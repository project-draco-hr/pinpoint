{
  final int jdbcSqlCacheSize=profilerConfig.getJdbcSqlCacheSize();
  DefaultTraceContext traceContext=new DefaultTraceContext(jdbcSqlCacheSize);
  traceContext.setAgentInformation(this.agentInformation);
  traceContext.setPriorityDataSender(this.tcpDataSender);
  Sampler sampler=createSampler();
  logger.info("SamplerType:{}",sampler.getClass());
  traceContext.setSampler(sampler);
  traceContext.setProfilerConfig(profilerConfig);
  if (profilerConfig.isSamplingElapsedTimeBaseEnable()) {
    TimeBaseStorageFactory timeBaseStorageFactory=new TimeBaseStorageFactory(this.spanDataSender,this.profilerConfig);
    traceContext.setStorageFactory(timeBaseStorageFactory);
  }
 else {
    traceContext.setStorageFactory(new BypassStorageFactory(spanDataSender));
  }
  return traceContext;
}
