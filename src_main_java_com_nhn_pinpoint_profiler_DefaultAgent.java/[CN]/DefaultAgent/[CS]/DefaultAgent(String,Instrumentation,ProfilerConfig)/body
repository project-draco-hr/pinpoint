{
  if (instrumentation == null) {
    throw new NullPointerException("instrumentation must not be null");
  }
  if (profilerConfig == null) {
    throw new NullPointerException("profilerConfig must not be null");
  }
  this.binder=new Slf4jLoggerBinder();
  bindPLoggerFactory(this.binder);
  dumpSystemProperties();
  dumpConfig(profilerConfig);
  changeStatus(AgentStatus.INITIALIZING);
  this.profilerConfig=profilerConfig;
  this.serverInfo=new ServerInfo();
  ApplicationServerTypeResolver typeResolver=new ApplicationServerTypeResolver(profilerConfig.getApplicationServerType());
  if (!typeResolver.resolve()) {
    throw new PinpointException("ApplicationServerType not found.");
  }
  this.byteCodeInstrumentor=new JavaAssistByteCodeInstrumentor(typeResolver.getServerLibPath(),this);
  if (logger.isInfoEnabled()) {
    logger.info("DefaultAgent classLoader:{}",this.getClass().getClassLoader());
  }
  this.classFileTransformer=new ClassFileTransformerDispatcher(this,byteCodeInstrumentor);
  instrumentation.addTransformer(this.classFileTransformer);
  this.agentInformation=createAgentInformation(typeResolver.getServerType());
  logger.info("agentInformation:{}",agentInformation);
  this.tcpDataSender=createTcpDataSender();
  this.spanDataSender=createUdpDataSender(this.profilerConfig.getCollectorUdpSpanServerPort(),"Pinpoint-UdpSpanDataExecutor");
  this.statDataSender=createUdpDataSender(this.profilerConfig.getCollectorUdpServerPort(),"Pinpoint-UdpStatDataExecutor");
  this.traceContext=createTraceContext();
  this.tAgentInfo=createTAgentInfo();
  this.tAgentKey=createTAgentKey();
  this.heartBitChecker=new HeartBitChecker(tcpDataSender,profilerConfig.getHeartbeatInterval(),tAgentInfo);
  this.agentStatMonitor=new AgentStatMonitor(this.statDataSender,this.agentInformation.getAgentId());
  SingletonHolder.INSTANCE=this;
  preLoadClass();
}
