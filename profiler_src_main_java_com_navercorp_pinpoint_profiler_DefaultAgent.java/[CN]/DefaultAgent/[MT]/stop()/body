{
synchronized (this) {
    if (this.agentStatus == AgentStatus.RUNNING) {
      changeStatus(AgentStatus.STOPPED);
    }
 else {
      logger.warn("Cannot stop agent. Current status = [{}]",this.agentStatus);
      return;
    }
  }
  logger.info("Stopping {} Agent.",ProductInfo.CAMEL_NAME);
  this.heartBeatChecker.stop();
  tAgentInfo.setEndStatus(0);
  tAgentInfo.setEndTimestamp(System.currentTimeMillis());
  this.tcpDataSender.send(tAgentInfo);
  this.agentStatMonitor.stop();
  this.spanDataSender.stop();
  this.statDataSender.stop();
  this.tcpDataSender.stop();
  if (this.socket != null) {
    this.socket.close();
  }
  if (this.factory != null) {
    this.factory.release();
  }
}
