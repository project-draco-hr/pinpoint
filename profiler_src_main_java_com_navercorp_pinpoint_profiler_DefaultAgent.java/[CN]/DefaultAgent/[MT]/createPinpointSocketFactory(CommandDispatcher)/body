{
  PinpointSocketFactory pinpointSocketFactory=new PinpointSocketFactory();
  pinpointSocketFactory.setTimeoutMillis(1000 * 5);
  Map<String,Object> properties=this.agentInformation.toMap();
  boolean isSupportServerMode=this.profilerConfig.isTcpDataSenderCommandAcceptEnable();
  if (isSupportServerMode) {
    pinpointSocketFactory.setMessageListener(commandDispatcher);
    pinpointSocketFactory.setServerStreamChannelMessageListener(commandDispatcher);
    properties.put(AgentHandshakePropertyType.SUPPORT_SERVER.getName(),true);
  }
 else {
    properties.put(AgentHandshakePropertyType.SUPPORT_SERVER.getName(),false);
  }
  pinpointSocketFactory.setProperties(properties);
  return pinpointSocketFactory;
}
