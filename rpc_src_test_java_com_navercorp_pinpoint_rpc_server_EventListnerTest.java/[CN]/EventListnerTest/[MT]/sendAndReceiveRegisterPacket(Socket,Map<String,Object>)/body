{
  sendRegisterPacket(socket.getOutputStream(),properties);
  ControlHandShakeResponsePacket packet=receiveRegisterConfirmPacket(socket.getInputStream());
  Map<Object,Object> result=(Map<Object,Object>)ControlMessageEnDeconderUtils.decode(packet.getPayload());
  return MapUtils.getInteger(result,"code",-1);
}
