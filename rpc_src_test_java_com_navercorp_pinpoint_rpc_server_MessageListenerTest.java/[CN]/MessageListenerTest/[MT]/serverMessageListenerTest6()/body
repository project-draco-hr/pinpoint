{
  DuplexCheckListener serverListener=new DuplexCheckListener();
  PinpointServerSocket ss=new PinpointServerSocket();
  ss.bind("127.0.0.1",10234);
  ss.setMessageListener(serverListener);
  PinpointSocketFactory socketFactory=createPinpointSocketFactory();
  socketFactory.setEnableWorkerPacketDelay(500);
  socketFactory.setMessageListener(new EchoMessageListener());
  try {
    PinpointSocket socket=socketFactory.connect("127.0.0.1",10234);
    Thread.sleep(5000);
    List<ChannelContext> channelContextList=ss.getDuplexCommunicationChannelContext();
    if (channelContextList.size() != 0) {
      Assert.fail();
    }
    if (serverListener.getReceiveEnableWorkerPacketCount() != 4) {
      Assert.fail();
    }
    socket.close();
  }
  finally {
    socketFactory.release();
    ss.close();
  }
}
