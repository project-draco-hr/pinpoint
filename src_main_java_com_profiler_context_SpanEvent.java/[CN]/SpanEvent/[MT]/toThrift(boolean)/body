{
  com.profiler.common.dto.thrift.SpanEvent spanEvent=new com.profiler.common.dto.thrift.SpanEvent();
  long parentSpanStartTime=parentSpan.getStartTime();
  spanEvent.setStartElapsed((int)(startTime - parentSpanStartTime));
  spanEvent.setEndElapsed((int)(endTime - startTime));
  spanEvent.setSequence(sequence);
  if (!child) {
    spanEvent.setAgentId(DefaultAgent.getInstance().getAgentId());
    spanEvent.setApplicationId(DefaultAgent.getInstance().getApplicationName());
    spanEvent.setParentServiceType(parentSpan.getServiceType().getCode());
    spanEvent.setParentEndPoint(parentSpan.getEndPoint());
    spanEvent.setAgentIdentifier(DefaultAgent.getInstance().getIdentifier());
    TraceID parentSpanTraceID=parentSpan.getTraceID();
    spanEvent.setMostTraceId(parentSpanTraceID.getId().getMostSignificantBits());
    spanEvent.setLeastTraceId(parentSpanTraceID.getId().getLeastSignificantBits());
    spanEvent.setSpanId(parentSpanTraceID.getSpanId());
  }
  spanEvent.setRpc(rpc);
  spanEvent.setServiceType(serviceType.getCode());
  spanEvent.setEndPoint(endPoint);
  spanEvent.setDestinationId(this.destionationId);
  List<Annotation> annotationList=new ArrayList<Annotation>(traceAnnotationList.size());
  for (  TraceAnnotation traceAnnotation : traceAnnotationList) {
    annotationList.add(traceAnnotation.toThrift());
  }
  spanEvent.setAnnotations(annotationList);
  if (depth != -1) {
    spanEvent.setDepth(depth);
  }
  if (nextSpanId != -1) {
    spanEvent.setNextSpanId(nextSpanId);
  }
  return spanEvent;
}
