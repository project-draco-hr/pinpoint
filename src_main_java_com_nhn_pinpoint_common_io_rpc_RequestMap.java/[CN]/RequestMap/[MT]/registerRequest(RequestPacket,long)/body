{
  final int requestId=getNextRequestId();
  request.setRequestId(requestId);
  final MessageFuture future=new MessageFuture(requestId,timeoutMillis);
  final MessageFuture old=this.requestMap.put(requestId,future);
  if (old != null) {
    throw new SocketException("unexpected error. old future exist:" + old + " id:"+ requestId);
  }
  future.setFailureHandle(this);
  addTimeoutTask(timeoutMillis,future);
  return future;
}
