{
  try {
    Timeout timeout=timer.newTimeout(future,timeoutMillis,TimeUnit.MILLISECONDS);
    future.setTimeout(timeout);
  }
 catch (  IllegalStateException e) {
    future.setFailure(new SocketException("socket closed"));
  }
}
