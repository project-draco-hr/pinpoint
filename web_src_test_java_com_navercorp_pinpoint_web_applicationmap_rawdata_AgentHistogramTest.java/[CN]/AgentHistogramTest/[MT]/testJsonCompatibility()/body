{
  AgentHistogram agentHistogram=new AgentHistogram(new Application("test",ServiceType.TOMCAT));
  TimeHistogram histogram=new TimeHistogram(ServiceType.TOMCAT,0);
  histogram.addCallCount(ServiceType.TOMCAT.getHistogramSchema().getErrorSlot().getSlotTime(),1);
  agentHistogram.addTimeHistogram(histogram);
  AgentHistogram copy=new AgentHistogram(agentHistogram);
  logger.debug(copy.getHistogram().toString());
  Assert.assertEquals(copy.getHistogram().getErrorCount(),1);
  TimeHistogram histogram2=new TimeHistogram(ServiceType.TOMCAT,0);
  histogram2.addCallCount(ServiceType.TOMCAT.getHistogramSchema().getErrorSlot().getSlotTime(),2);
  agentHistogram.addTimeHistogram(histogram2);
  Assert.assertEquals(agentHistogram.getHistogram().getErrorCount(),3);
  String callJson=mapper.writeValueAsString(agentHistogram);
  String before=originalJson(agentHistogram);
  logger.debug("callJson:{}",callJson);
  HashMap callJsonHashMap=mapper.readValue(callJson,HashMap.class);
  logger.debug("before:{}",before);
  HashMap beforeJsonHashMap=mapper.readValue(before,HashMap.class);
  logger.debug("{} {}",callJsonHashMap,beforeJsonHashMap);
  Assert.assertEquals(callJsonHashMap,beforeJsonHashMap);
}
