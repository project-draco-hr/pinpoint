{
  StopWatch watch=new StopWatch();
  watch.start("agentStatService.selectAgentStatList");
  List<TAgentStat> agentStatList=agentStatService.selectAgentStatList(agentId,from,to);
  watch.stop();
  if (logger.isInfoEnabled()) {
    logger.info("getAgentStat(agentId={}, from={}, to={}) : {}ms",agentId,from,to,watch.getLastTaskTimeMillis());
  }
  int nPoints=(int)(to - from) / 5000;
  if (sampleRate == null) {
    sampleRate=nPoints < 300 ? 1 : nPoints / 300;
  }
  AgentStatChartGroup chart=new AgentStatChartGroup();
  for (  TAgentStat each : agentStatList) {
    chart.addData(each,sampleRate);
  }
  response.setContentType("text/javascript; charset=UTF-8");
  PrintWriter out=response.getWriter();
  if (jsonpCallback != null) {
    out.write(jsonpCallback + "(" + jsonObjectMapper.writeValueAsString(chart)+ ")");
  }
 else {
    out.write(jsonObjectMapper.writeValueAsString(chart));
  }
  out.close();
}
