{
  TraceID.TraceKey traceIdKey=traceId.getTraceKey();
  Span span=map.get(traceIdKey);
  if (span == null) {
    span=new Span(traceId);
    map.put(traceIdKey,span);
    TimerTask task=new FlushTimedoutSpanTask(span);
    timer.schedule(task,FLUSH_TIMEOUT);
  }
  return spanUpdater.updateSpan(span);
}
