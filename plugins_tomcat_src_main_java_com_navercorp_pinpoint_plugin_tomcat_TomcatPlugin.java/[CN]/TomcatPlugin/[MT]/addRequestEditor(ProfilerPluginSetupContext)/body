{
  context.addClassFileTransformer("org.apache.catalina.connector.Request",new TransformCallback(){
    @Override public byte[] doInTransform(    Instrumentor instrumentContext,    ClassLoader classLoader,    String className,    Class<?> classBeingRedefined,    ProtectionDomain protectionDomain,    byte[] classfileBuffer) throws InstrumentException {
      InstrumentClass target=instrumentContext.getInstrumentClass(classLoader,className,classfileBuffer);
      target.addField(TomcatConstants.METADATA_TRACE);
      target.addField(TomcatConstants.METADATA_ASYNC);
      InstrumentMethod recycleMethodEditorBuilder=target.getDeclaredMethod("recycle");
      if (recycleMethodEditorBuilder != null) {
        recycleMethodEditorBuilder.addInterceptor("com.navercorp.pinpoint.plugin.tomcat.interceptor.RequestRecycleInterceptor");
      }
      InstrumentMethod startAsyncMethodEditor=target.getDeclaredMethod("startAsync","javax.servlet.ServletRequest","javax.servlet.ServletResponse");
      if (startAsyncMethodEditor != null) {
        startAsyncMethodEditor.addInterceptor("com.navercorp.pinpoint.plugin.tomcat.interceptor.RequestStartAsyncInterceptor");
      }
      return target.toBytecode();
    }
  }
);
}
