{
  if (!instrumentation.isModifiableClass(target)) {
    throw new ProfilerException("Target class " + target + " is not modifiable");
  }
  Modifier prev=targets.putIfAbsent(target,modifier);
  if (prev != null) {
    throw new ProfilerException("Retransform already requested. target: " + target + ", modifier: "+ prev);
  }
  try {
    instrumentation.retransformClasses(target);
  }
 catch (  UnmodifiableClassException e) {
    throw new ProfilerException(e);
  }
}
