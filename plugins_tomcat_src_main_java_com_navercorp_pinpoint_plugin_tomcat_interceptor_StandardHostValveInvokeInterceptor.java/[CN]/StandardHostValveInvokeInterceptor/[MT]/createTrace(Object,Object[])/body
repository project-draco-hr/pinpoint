{
  final Request request=(Request)args[0];
  if (request.getAttribute("PINPOINT_TRACE") != null) {
    Trace trace=(Trace)request.getAttribute("PINPOINT_TRACE");
    getTraceContext().attachTraceObject(trace);
    logger.debug("Continue servlet process");
    if (asyncAccessor.isApplicable(request) && asyncAccessor.get(request) != null) {
      logger.debug("Check async");
      Boolean async=asyncAccessor.get(request);
      if (async) {
        getTraceContext().cacheApi(TomcatConstants.servletAsynchronousMethodDescriptor);
        trace.recordApi(TomcatConstants.servletAsynchronousMethodDescriptor);
      }
    }
    return trace;
  }
  final String requestURI=request.getRequestURI();
  if (excludeUrlFilter.filter(requestURI)) {
    if (isTrace) {
      logger.trace("filter requestURI:{}",requestURI);
    }
    return null;
  }
  final boolean sampling=samplingEnable(request);
  if (!sampling) {
    final TraceContext traceContext=getTraceContext();
    final Trace trace=traceContext.disableSampling();
    if (isDebug) {
      logger.debug("remotecall sampling flag found. skip trace requestUrl:{}, remoteAddr:{}",request.getRequestURI(),request.getRemoteAddr());
    }
    return trace;
  }
  final TraceId traceId=populateTraceIdFromRequest(request);
  if (traceId != null) {
    final TraceContext traceContext=getTraceContext();
    final Trace trace=traceContext.continueTraceObject(traceId);
    initTrace(trace,request);
    if (trace.canSampled()) {
      if (isDebug) {
        logger.debug("TraceID exist. continue trace. traceId:{}, requestUrl:{}, remoteAddr:{}",new Object[]{traceId,request.getRequestURI(),request.getRemoteAddr()});
      }
    }
 else {
      if (isDebug) {
        logger.debug("TraceID exist. camSampled is false. skip trace. traceId:{}, requestUrl:{}, remoteAddr:{}",new Object[]{traceId,request.getRequestURI(),request.getRemoteAddr()});
      }
    }
    return trace;
  }
 else {
    final TraceContext traceContext=getTraceContext();
    final Trace trace=traceContext.newTraceObject();
    initTrace(trace,request);
    if (trace.canSampled()) {
      if (isDebug) {
        logger.debug("TraceID not exist. start new trace. requestUrl:{}, remoteAddr:{}",request.getRequestURI(),request.getRemoteAddr());
      }
    }
 else {
      if (isDebug) {
        logger.debug("TraceID not exist. camSampled is false. skip trace. requestUrl:{}, remoteAddr:{}",request.getRequestURI(),request.getRemoteAddr());
      }
    }
    return trace;
  }
}
