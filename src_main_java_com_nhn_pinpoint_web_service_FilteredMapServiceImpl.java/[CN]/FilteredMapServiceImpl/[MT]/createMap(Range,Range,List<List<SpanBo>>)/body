{
  final TimeWindow window=new TimeWindow(range,TimeWindowOneMinuteSampler.SAMPLER);
  final LinkDataMap linkDataMap=new LinkDataMap();
  final DotExtractor dotExtractor=new DotExtractor(scanRange);
  final MapResponseHistogramSummary mapHistogramSummary=new MapResponseHistogramSummary(range);
  for (  List<SpanBo> transaction : filterList) {
    final Map<Long,SpanBo> transactionSpanMap=checkDuplicatedSpanId(transaction);
    for (    SpanBo span : transaction) {
      final Application srcApplication=createSourceApplication(span,transactionSpanMap);
      final Application destApplication=new Application(span.getApplicationId(),span.getServiceType());
      recordSpanResponseTime(destApplication,span,mapHistogramSummary,span.getCollectorAcceptTime());
      if (!destApplication.getServiceType().isRecordStatistics() || destApplication.getServiceType().isRpcClient()) {
        continue;
      }
      final short slotTime=getHistogramSlotTime(span,destApplication.getServiceType());
      long timestamp=window.refineTimestamp(span.getCollectorAcceptTime());
      linkDataMap.addLinkData(srcApplication,span.getAgentId(),destApplication,destApplication.getName(),timestamp,slotTime,1);
      addNodeFromSpanEvent(span,window,linkDataMap,transactionSpanMap);
      dotExtractor.addDot(span);
    }
  }
  List<ApplicationScatterScanResult> applicationScatterScanResult=dotExtractor.getApplicationScatterScanResult();
  LinkDataDuplexMap linkDataDuplexMap=new LinkDataDuplexMap(linkDataMap);
  ApplicationMapBuilder applicationMapBuilder=new ApplicationMapBuilder(range);
  ApplicationMap map=applicationMapBuilder.build(linkDataDuplexMap,agentInfoService);
  mapHistogramSummary.build();
  map.appendResponseTime(mapHistogramSummary);
  map.setApplicationScatterScanResult(applicationScatterScanResult);
  return map;
}
