{
  Map<AgentInfo,Future<ResponseMessage>> futureMap=new HashMap<AgentInfo,Future<ResponseMessage>>();
  for (  AgentInfo agentInfo : agentInfoList) {
    TCommandTransfer transferObject=createCommandTransferObject(agentInfo,payload);
    PinpointSocket socket=clusterConnectionManager.getSocket(agentInfo);
    if (socket != null) {
      Future<ResponseMessage> future=socket.request(serializeRequest(transferObject));
      futureMap.put(agentInfo,future);
    }
 else {
      futureMap.put(agentInfo,null);
    }
  }
  long startTime=System.currentTimeMillis();
  Map<AgentInfo,PinpointRouteResponse> result=new HashMap<AgentInfo,PinpointRouteResponse>();
  for (  Map.Entry<AgentInfo,Future<ResponseMessage>> futureEntry : futureMap.entrySet()) {
    AgentInfo agentInfo=futureEntry.getKey();
    Future<ResponseMessage> future=futureEntry.getValue();
    PinpointRouteResponse response=getResponse(future,getTimeoutMillis(startTime,timeout));
    result.put(agentInfo,response);
  }
  return result;
}
