{
  try {
    ClientStreamChannelContext clientStreamChannelContext=agentService.openStream(agentInfo,new TCmdActiveThreadCount(),this);
    if (clientStreamChannelContext.getCreateFailPacket() == null) {
      this.streamchannel=clientStreamChannelContext.getStreamChannel();
      this.streamchannel.addStateChangeEventHandler(this);
      defaultFailedResponse.setFail(TRouteResult.TIMEOUT.name());
    }
 else {
      StreamCreateFailPacket createFailPacket=clientStreamChannelContext.getCreateFailPacket();
      defaultFailedResponse.setFail(createFailPacket.getCode().name());
    }
  }
 catch (  TException exception) {
    defaultFailedResponse.setFail(TRouteResult.NOT_SUPPORTED_REQUEST.name());
  }
 finally {
    this.responseAggregator.getStreamMessageListenerRepository().put(agentInfo.getAgentId(),this);
  }
}
