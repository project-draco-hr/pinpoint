{
  RequestMap requestMap=new RequestMap(10);
  try {
    RequestPacket packet=new RequestPacket(1,new byte[0]);
    MessageFuture messageFuture=requestMap.registerRequest(packet,2000);
    messageFuture.setFailure(new RuntimeException());
    MessageFuture nullFuture=requestMap.removeMessageFuture(packet.getRequestId());
    Assert.assertNull(nullFuture);
  }
  finally {
    requestMap.close();
  }
}
