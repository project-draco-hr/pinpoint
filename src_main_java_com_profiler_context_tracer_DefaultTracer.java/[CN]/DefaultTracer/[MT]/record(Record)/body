{
  final Annotation ann=record.getAnnotation();
  if (ann instanceof Annotation.ClientSend) {
    annotate(record,"CS");
  }
 else   if (ann instanceof Annotation.ClientRecv) {
    annotate(record,"CR");
  }
 else   if (ann instanceof Annotation.ServerSend) {
    annotate(record,"SS");
  }
 else   if (ann instanceof Annotation.ServerRecv) {
    annotate(record,"SR");
  }
 else   if (ann instanceof Annotation.Message) {
    annotate(record,((Annotation.Message)ann).getMessage());
  }
 else   if (ann instanceof Annotation.RpcName) {
    mutate(record.getTraceId(),new SpanUpdater(){
      @Override public Span updateSpan(      Span span){
        RpcName a=(RpcName)ann;
        span.setName(a.getRpc());
        span.setServiceName(a.getService());
        return span;
      }
    }
);
  }
 else   if (ann instanceof Annotation.ClientAddr) {
    ClientAddr a=(ClientAddr)ann;
    setEndPoint(record,new EndPoint(a.getIp(),a.getPort()));
  }
 else   if (ann instanceof Annotation.ServerAddr) {
    ServerAddr a=(ServerAddr)ann;
    setEndPoint(record,new EndPoint(a.getIp(),a.getPort()));
  }
}
