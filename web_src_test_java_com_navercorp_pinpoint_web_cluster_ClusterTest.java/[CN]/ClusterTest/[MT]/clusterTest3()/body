{
  ts.restart();
  PinpointSocketFactory factory=null;
  PinpointSocket socket=null;
  ZooKeeper zookeeper=null;
  try {
    Thread.sleep(5000);
    zookeeper=new ZooKeeper(zookeeperAddress,5000,null);
    getNodeAndCompareContents(zookeeper);
    Assert.assertEquals(0,socketManager.getCollectorList().size());
    factory=new PinpointSocketFactory();
    factory.setMessageListener(new SimpleListener());
    socket=factory.connect(DEFAULT_IP,acceptorPort);
    Thread.sleep(1000);
    Assert.assertEquals(1,socketManager.getCollectorList().size());
  }
  finally {
    closePinpointSocket(factory,socket);
    if (zookeeper != null) {
      zookeeper.close();
    }
  }
}
