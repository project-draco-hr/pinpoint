{
  ts.restart();
  PinpointClientFactory clientFactory=null;
  PinpointClient client=null;
  ZooKeeper zookeeper=null;
  try {
    Thread.sleep(5000);
    zookeeper=new ZooKeeper(zookeeperAddress,5000,null);
    getNodeAndCompareContents(zookeeper);
    Assert.assertEquals(0,socketManager.getCollectorList().size());
    clientFactory=new PinpointClientFactory();
    clientFactory.setMessageListener(new SimpleListener());
    client=clientFactory.connect(DEFAULT_IP,acceptorPort);
    Thread.sleep(1000);
    Assert.assertEquals(1,socketManager.getCollectorList().size());
  }
  finally {
    closePinpointSocket(clientFactory,client);
    if (zookeeper != null) {
      zookeeper.close();
    }
  }
}
