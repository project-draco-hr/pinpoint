{
  StreamChannelStateCode currentState=getCurrentState();
  boolean isChanged=state.to(currentState,nextState);
  if (!isChanged && (getCurrentState() != StreamChannelStateCode.ILLEGAL_STATE)) {
    changeStateTo(StreamChannelStateCode.ILLEGAL_STATE);
  }
  if (isChanged) {
    for (    StreamChannelStateChangeEventHandler h : stateChangeEventHandlers) {
      try {
        h.eventPerformed(this,nextState);
      }
 catch (      Exception e) {
        h.exceptionCaught(this,nextState,e);
      }
    }
  }
  return isChanged;
}
