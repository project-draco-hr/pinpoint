{
  int depth=spanDepth + 1;
  if (logger.isDebugEnabled()) {
    logger.info("span depth:{}",depth);
  }
  int lastChildSequence=sequence;
  SpanAlign element=new SpanAlign(depth,parentSpan,++lastChildSequence,pSequence);
  container.add(element);
  List<SpanEventBo> spanEventBoList=parentSpan.getSpanEventBoList();
  if (spanEventBoList == null) {
    return sequence;
  }
  element.setHasChild(true);
  for (  SpanEventBo spanEventBo : spanEventBoList) {
    if (spanEventBo.getDepth() != -1) {
      depth=spanDepth + spanEventBo.getDepth();
      if (logger.isDebugEnabled()) {
        logger.debug("spanEvent spanEvent{} depth:{} getDepth():{}",spanEventBo.getServiceType(),depth,spanEventBo.getDepth());
      }
    }
 else {
      if (logger.isDebugEnabled()) {
        logger.debug("spanEvent depth:{} ",depth);
      }
    }
    lastChildSequence++;
    SpanAlign sa=new SpanAlign(depth,lastChildSequence,sequence,parentSpan,spanEventBo);
    container.add(sa);
    int nextSpanId=spanEventBo.getNextSpanId();
    if (nextSpanId != ROOT && spanMap.containsKey(nextSpanId)) {
      lastChildSequence=populate(spanMap.get(nextSpanId),depth,lastChildSequence,lastChildSequence,container);
    }
  }
  return lastChildSequence;
}
