{
  try {
    trans.reset(bytes);
    Header header=readHeader();
    final int validate=validate(header);
    if (validate == HeaderUtils.OK) {
      TBase<?,?> base=locator.tBaseLookup(header.getType());
      base.read(protocol);
      return base;
    }
    if (validate == HeaderUtils.PASS_L4) {
      return new L4Packet(header);
    }
    throw new IllegalStateException("invalid validate " + validate);
  }
  finally {
    trans.clear();
    protocol.reset();
  }
}
