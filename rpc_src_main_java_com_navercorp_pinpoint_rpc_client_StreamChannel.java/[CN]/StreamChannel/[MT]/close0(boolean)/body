{
  if (!state.compareAndSet(RUN,CLOSED)) {
    return false;
  }
  if (safeClose) {
    StreamClosePacket closePacket=new StreamClosePacket(this.channelId,StreamClosePacket.SUCCESS);
    this.channel.write(closePacket);
    StreamChannelManager streamChannelManager=this.streamChannelManager;
    if (streamChannelManager != null) {
      streamChannelManager.closeChannel(channelId);
      this.streamChannelManager=null;
    }
  }
  return true;
}
