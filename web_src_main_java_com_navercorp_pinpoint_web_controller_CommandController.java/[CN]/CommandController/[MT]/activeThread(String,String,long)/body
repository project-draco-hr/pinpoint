{
  PinpointServer collector=socketManager.getCollector(applicationName,agentId,startTimeStamp);
  if (collector == null) {
    return createResponse(false,String.format("Can't find suitable PinpointServer(%s/%s/%d).",applicationName,agentId,startTimeStamp));
  }
  TActiveThread activeThread=new TActiveThread();
  byte[] payload=serialize(activeThread);
  TCommandTransfer transfer=new TCommandTransfer();
  transfer.setApplicationName(applicationName);
  transfer.setAgentId(agentId);
  transfer.setStartTime(startTimeStamp);
  transfer.setPayload(payload);
  Future<ResponseMessage> future=collector.request(serialize(transfer));
  future.await();
  String exceptionMessage=StringUtils.EMPTY;
  ResponseMessage responseMessage=future.getResult();
  try {
    TBase result=deserialize(responseMessage.getMessage());
    if (result instanceof TActiveThreadResponse) {
      return createResponse(true,((TActiveThreadResponse)result).getActiveThreadCount());
    }
  }
 catch (  TException e) {
    exceptionMessage=e.getMessage();
  }
  return createResponse(false,exceptionMessage);
}
