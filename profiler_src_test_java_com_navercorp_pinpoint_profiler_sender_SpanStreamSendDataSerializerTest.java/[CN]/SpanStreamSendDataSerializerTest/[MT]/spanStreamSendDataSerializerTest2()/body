{
  int spanEventSize=10;
  SpanStreamSendDataSerializer serializer=new SpanStreamSendDataSerializer();
  HeaderTBaseSerializerFactory factory=new HeaderTBaseSerializerFactory();
  Span span=createSpan(createSpanEventList(spanEventSize));
  CompositeSpanStreamData spanData=serializer.serializeSpanStream(factory.createSerializer(),span);
  Assert.assertEquals(spanEventSize + 1,spanData.getComponentsCount());
  HeaderTBaseDeserializer deserializer=new HeaderTBaseDeserializerFactory().createDeserializer();
  for (int i=0; i < spanData.getComponentsCount(); i++) {
    ByteBuffer byteBuffer=spanData.getByteBuffer(i);
    byte[] readBuffer=new byte[byteBuffer.remaining()];
    byteBuffer.get(readBuffer);
    Object o=deserializer.deserialize(readBuffer);
    if (o == null) {
      Assert.fail();
    }
    if (i < spanEventSize) {
      Assert.assertTrue(o instanceof TSpanEvent);
    }
 else {
      Assert.assertTrue(o instanceof TSpan);
    }
  }
}
