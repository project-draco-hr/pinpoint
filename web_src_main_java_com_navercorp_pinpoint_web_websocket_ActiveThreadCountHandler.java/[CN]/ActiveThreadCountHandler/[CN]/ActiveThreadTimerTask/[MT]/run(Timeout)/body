{
  long startTime=System.currentTimeMillis();
  try {
    logger.info("ActiveThreadTimerTask started.");
    Collection<PinpointWebSocketResponseAggregator> values=aggregatorRepository.values();
    for (    PinpointWebSocketResponseAggregator aggregator : values) {
      try {
        aggregator.flush();
      }
 catch (      Exception e) {
        logger.warn(e.getMessage(),e);
      }
    }
  }
  finally {
    if (timer != null && onTimerTask.get()) {
      long execTime=System.currentTimeMillis() - startTime;
      long nextFlushDelay=flushDelay - execTime;
      if (nextFlushDelay < DEFAULT_MIN_FLUSH_DELAY) {
        timer.newTimeout(this,DEFAULT_MIN_FLUSH_DELAY,TimeUnit.MILLISECONDS);
      }
 else {
        timer.newTimeout(this,nextFlushDelay,TimeUnit.MILLISECONDS);
      }
    }
  }
}
