{
  String applicationName=(String)webSocketSession.getAttributes().get(APPLICATION_NAME_KEY);
  if (StringUtils.isEmpty(applicationName)) {
    return;
  }
  PinpointWebSocketResponseAggregator aggregator=aggregatorRepository.get(applicationName);
  if (aggregator == null) {
    return;
  }
  boolean cleared=aggregator.removeWebSocketSessionAndGetIsCleared(webSocketSession);
  if (cleared) {
    aggregatorRepository.remove(applicationName);
    aggregator.stop();
  }
}
