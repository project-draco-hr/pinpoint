{
  String applicationName=(String)webSocketSession.getAttributes().get(APPLICATION_NAME_KEY);
  if (StringUtils.isEmpty(applicationName)) {
    return;
  }
  WebSocketResponseAggregator aggregator=aggregatorRepository.get(applicationName);
  if (aggregator == null) {
    return;
  }
  aggregator.unregisterWebSocketSession(webSocketSession);
  if (aggregator.registeredWebSocketSessionCount() == 0) {
    for (    ActiveThreadCountStreamListener listener : aggregator.getStreamMessageListenerRepository().values()) {
      listener.stop();
    }
    aggregatorRepository.remove(applicationName);
  }
}
