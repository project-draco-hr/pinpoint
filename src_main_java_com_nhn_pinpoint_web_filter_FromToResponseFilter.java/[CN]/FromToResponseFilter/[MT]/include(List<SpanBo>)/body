{
  if (includeServiceType(fromServiceCode,ServiceType.USER)) {
    for (    SpanBo span : transaction) {
      if (span.isRoot() && includeServiceType(toServiceCode,span.getServiceType()) && toApplicationName.equals(span.getApplicationId())) {
        return checkResponseCondition(span.getElapsed(),span.getErrCode() > 0) && checkPinPointAgentName(null,span.getAgentId());
      }
    }
  }
 else   if (includeUnknown(toServiceCode)) {
    for (    SpanBo span : transaction) {
      if (includeServiceType(fromServiceCode,span.getServiceType()) && fromApplicationName.equals(span.getApplicationId())) {
        List<SpanEventBo> eventBoList=span.getSpanEventBoList();
        if (eventBoList == null) {
          continue;
        }
        for (        SpanEventBo event : eventBoList) {
          if (event.getServiceType().isRpcClient() && toApplicationName.equals(event.getDestinationId())) {
            return checkResponseCondition(event.getEndElapsed(),event.hasException());
          }
        }
      }
    }
  }
 else   if (includeWas(toServiceCode)) {
    if (hint.containApplicationHint(toApplicationName)) {
      for (      SpanBo srcSpan : transaction) {
        List<SpanEventBo> eventBoList=srcSpan.getSpanEventBoList();
        if (eventBoList == null) {
          continue;
        }
        for (        SpanEventBo event : eventBoList) {
          if (!event.getServiceType().isRpcClient()) {
            continue;
          }
          if (!hint.containApplicationEndpoint(toApplicationName,event.getDestinationId(),event.getServiceType().getCode())) {
            continue;
          }
          return checkResponseCondition(event.getEndElapsed(),event.hasException());
        }
      }
    }
 else {
      for (      SpanBo srcSpan : transaction) {
        if (includeServiceType(fromServiceCode,srcSpan.getServiceType()) && fromApplicationName.equals(srcSpan.getApplicationId())) {
          for (          SpanBo destSpan : transaction) {
            if (destSpan.getParentSpanId() != srcSpan.getSpanId()) {
              continue;
            }
            if (includeServiceType(toServiceCode,destSpan.getServiceType()) && toApplicationName.equals(destSpan.getApplicationId())) {
              return checkResponseCondition(destSpan.getElapsed(),destSpan.getErrCode() > 0) && checkPinPointAgentName(srcSpan.getAgentId(),destSpan.getAgentId());
            }
          }
        }
      }
    }
  }
 else {
    for (    SpanBo span : transaction) {
      if (includeServiceType(fromServiceCode,span.getServiceType()) && fromApplicationName.equals(span.getApplicationId())) {
        List<SpanEventBo> eventBoList=span.getSpanEventBoList();
        if (eventBoList == null) {
          continue;
        }
        for (        SpanEventBo event : eventBoList) {
          if (includeServiceType(toServiceCode,event.getServiceType()) && toApplicationName.equals(event.getDestinationId())) {
            return checkResponseCondition(event.getEndElapsed(),event.hasException()) && checkPinPointAgentName(span.getAgentId(),null);
          }
        }
      }
    }
  }
  return false;
}
