{
  byte[] agentIDBytes=BytesUtils.getBytes(agentId);
  byte[] rpcBytes=BytesUtils.getBytes(rpc);
  byte[] serviceNameBytes=BytesUtils.getBytes(serviceName);
  byte[] endPointBytes=BytesUtils.getBytes(endPoint);
  int bufferLength=getBufferLength(agentIDBytes.length,rpcBytes.length,serviceNameBytes.length,endPointBytes.length);
  Buffer buffer=new Buffer(bufferLength);
  buffer.put(version);
  buffer.put1PrefixedBytes(agentIDBytes);
  buffer.put(parentSpanId);
  buffer.put(startTime);
  buffer.put(elapsed);
  buffer.put1PrefixedBytes(rpcBytes);
  buffer.put1PrefixedBytes(serviceNameBytes);
  buffer.put(serviceType.getCode());
  buffer.put1PrefixedBytes(endPointBytes);
  buffer.put(exception);
  if (flag != 0) {
    buffer.put(flag);
  }
  return buffer.getBuffer();
}
