{
  final ClassFileTransformerBuilder classBuilder=context.getClassFileTransformerBuilder(targetClassName);
  classBuilder.injectMetadata(METADATA_ASYNC_TRACE_ID);
  classBuilder.conditional(new ClassCondition(){
    @Override public boolean check(    ProfilerPluginContext context,    ClassLoader classLoader,    InstrumentClass target){
      if (!target.hasConstructor(new String[]{"com.google.api.client.http.HttpRequest"})) {
        return false;
      }
      if (!target.hasMethod("call",null,"com.google.api.client.http.HttpResponse")) {
        return false;
      }
      return true;
    }
  }
,new ConditionalClassFileTransformerSetup(){
    @Override public void setup(    ConditionalClassFileTransformerBuilder conditional){
      ConstructorTransformerBuilder constructorBuilder=conditional.editConstructor("com.google.api.client.http.HttpRequest");
      constructorBuilder.injectInterceptor("com.navercorp.pinpoint.plugin.google.httpclient.interceptor.HttpRequestExecuteAsyncMethodInnerClassConstructorInterceptor");
      MethodTransformerBuilder methodBuilder=conditional.editMethods(new HttpRequestExceuteAsyncMethodInnerClassMethodFilter());
      methodBuilder.exceptionHandler(new MethodTransformerExceptionHandler(){
        public void handle(        String targetClassName,        String targetMethodName,        String[] targetMethodParameterTypes,        Throwable exception) throws Throwable {
          if (logger.isWarnEnabled()) {
            logger.warn("[GoogleHttpClient] Unsupported method " + targetClassName + "."+ targetMethodName,exception);
          }
        }
      }
);
      methodBuilder.injectInterceptor("com.navercorp.pinpoint.plugin.google.httpclient.interceptor.HttpRequestExecuteAsyncMethodInnerClassCallMethodInterceptor");
    }
  }
);
  context.addClassFileTransformer(classBuilder.build());
}
