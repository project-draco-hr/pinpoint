{
  boolean marked=false;
  for (  SpanAlign spanAlign : spanAligns) {
    if (spanAlign.isSpan()) {
      SpanBo spanBo=spanAlign.getSpanBo();
      AnnotationUtils.sortAnnotationListByKey(spanBo);
      String method=(String)AnnotationUtils.getDisplayMethod(spanBo);
      String arguments=(String)AnnotationUtils.getDisplayArgument(spanBo);
      long begin=spanBo.getStartTime();
      long elapsed=spanBo.getElapsed();
      if (!marked) {
        setStartTime(begin);
        setEndTime(begin + elapsed);
        applicationName=arguments;
        beginTimestamp=begin;
        marked=true;
      }
      if (spanBo.getCollectorAcceptTime() == focusTimestamp) {
        applicationName=arguments;
        beginTimestamp=begin;
      }
      Record record=new Record(spanAlign.getDepth(),true,method,arguments,begin,elapsed,spanBo.getAgentId(),spanBo.getApplicationId(),spanBo.getServiceType(),null);
      recordset.add(record);
      addAnnotationRecord(spanAlign.getDepth() + 1,spanBo.getAnnotationBoList());
    }
 else {
      SpanEventBo spanEventBo=spanAlign.getSpanEventBo();
      AnnotationUtils.sortAnnotationListByKey(spanEventBo);
      String method=(String)AnnotationUtils.getDisplayMethod(spanEventBo);
      Object arguments=AnnotationUtils.getDisplayArgument(spanEventBo);
      long begin=spanAlign.getSpanBo().getStartTime() + spanEventBo.getStartElapsed();
      long elapsed=spanEventBo.getEndElapsed();
      if (!marked) {
        setStartTime(begin);
        setEndTime(begin + elapsed);
        marked=true;
      }
      String destinationId=spanEventBo.getDestinationId();
      recordset.add(new Record(spanAlign.getDepth(),true,method,(arguments != null) ? arguments.toString() : "",begin,elapsed,spanEventBo.getAgentId(),spanEventBo.getDestinationId(),spanEventBo.getServiceType(),destinationId));
      addAnnotationRecord(spanAlign.getDepth() + 1,spanEventBo.getAnnotationBoList());
    }
  }
}
