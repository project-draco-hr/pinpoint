{
  DefaultAgent agent=MockAgent.of("pinpoint-spring-bean-test.config");
  ByteCodeInstrumentor realInstrumentor=agent.getByteCodeInstrumentor();
  final ClassLoader loader=getClass().getClassLoader();
  byte[] byteCode=BytecodeUtils.getClassFile(loader,TARGET);
  ByteCodeInstrumentor instrumentor=mock(ByteCodeInstrumentor.class);
  InstrumentableClass instrumentClass=mock(InstrumentableClass.class);
  when(instrumentor.getClass(loader,TARGET_INTERNAL_NAME,byteCode)).thenReturn(instrumentClass);
  when(instrumentClass.isInterceptable()).thenReturn(true);
  when(instrumentClass.getDeclaredMethods(BeanMethodModifier.METHOD_FILTER)).thenReturn(realInstrumentor.getClass(loader,TARGET,byteCode).getDeclaredMethods(BeanMethodModifier.METHOD_FILTER));
  BeanMethodModifier modifier=new BeanMethodModifier(instrumentor);
  modifier.modify(loader,TARGET_INTERNAL_NAME,null,byteCode);
  verify(instrumentor).getClass(loader,TARGET_INTERNAL_NAME,byteCode);
  verify(instrumentClass).isInterceptable();
  verify(instrumentClass).getDeclaredMethods(BeanMethodModifier.METHOD_FILTER);
  verify(instrumentClass).addInterceptor(eq("publicMethod"),eq(new String[0]),isA(MethodInterceptor.class));
  verify(instrumentClass).addInterceptor(eq("compareTo"),eq(new String[]{TARGET}),isA(MethodInterceptor.class));
  verify(instrumentClass).toBytecode();
  verifyNoMoreInteractions(instrumentor,instrumentClass);
}
