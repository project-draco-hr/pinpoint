{
  List<SpanEvent> spanEventList;
synchronized (this) {
    spanEventList=storage;
    this.storage=null;
  }
  if (async) {
    if (spanEventList != null && !spanEventList.isEmpty()) {
      final SpanChunk spanChunk=spanChunkFactory.create(spanEventList);
      dataSender.send(spanChunk);
    }
  }
 else {
    if (spanEventList != null && !spanEventList.isEmpty()) {
      span.setSpanEventList((List)spanEventList);
    }
    dataSender.send(span);
  }
  if (isDebug) {
    logger.debug("flush span {}",span);
  }
}
