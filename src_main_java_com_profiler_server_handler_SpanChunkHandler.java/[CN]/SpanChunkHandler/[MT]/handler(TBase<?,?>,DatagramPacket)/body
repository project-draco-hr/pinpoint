{
  try {
    SpanChunk spanChunk=(SpanChunk)tbase;
    if (logger.isDebugEnabled()) {
      logger.debug("Received SpanChunk={}",spanChunk);
    }
    String applicationName=agentIdApplicationIndexDao.selectApplicationName(spanChunk.getAgentId());
    if (applicationName == null) {
      logger.warn("Applicationname '{}' not found. Drop the log.",applicationName);
      return;
    }
 else {
      logger.info("Applicationname '{}' found. Write the log.",applicationName);
    }
    traceDao.insertSpanChunk(applicationName,spanChunk);
    List<SpanEvent> spanEventList=spanChunk.getSpanEventList();
    if (spanEventList != null) {
      logger.debug("SpanChunk Size:{}",spanEventList.size());
      for (      SpanEvent spanEvent : spanEventList) {
        ServiceType serviceType=ServiceType.findServiceType(spanEvent.getServiceType());
        if (!serviceType.isRecordStatistics()) {
          continue;
        }
        int elapsed=spanEvent.getEndElapsed();
        boolean hasException=SpanEventUtils.hasException(spanEvent);
        if (serviceType.isRpcClient()) {
          terminalStatistics.update(applicationName,spanEvent.getDestinationId(),serviceType.getCode(),elapsed,hasException);
        }
 else {
          terminalStatistics.update(applicationName,spanEvent.getDestinationId(),serviceType.getCode(),elapsed,hasException);
        }
      }
    }
  }
 catch (  Exception e) {
    logger.warn("SpanChunk handle error " + e.getMessage(),e);
  }
}
