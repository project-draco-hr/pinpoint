{
  AtomicInteger requestCount=new AtomicInteger();
  AtomicInteger successCount=new AtomicInteger();
  ResponseServerMessageListener serverListener=new ResponseServerMessageListener(requestCount,successCount);
  PinpointSocketFactory socketFactory=createPinpointSocketFactory();
  PinpointSocket socket=createPinpointSocket(HOST,PORT,socketFactory);
  TcpDataSender sender=new TcpDataSender(socket);
  HeartBitChecker checker=new HeartBitChecker(sender,1000L,getAgentInfo());
  long strarTime=System.currentTimeMillis();
  try {
    checker.start();
    Random random=new Random(System.currentTimeMillis());
    while (System.currentTimeMillis() < strarTime + STRESS_TEST_TIME) {
      createAndDeleteServer(serverListener,Math.abs(random.nextInt(RANDOM_MAX_TIME)));
      Thread.sleep(Math.abs(random.nextInt(1000)));
    }
  }
  finally {
    if (checker != null) {
      checker.stop();
    }
    if (socket != null) {
      socket.close();
    }
    if (socketFactory != null) {
      socketFactory.release();
    }
  }
}
