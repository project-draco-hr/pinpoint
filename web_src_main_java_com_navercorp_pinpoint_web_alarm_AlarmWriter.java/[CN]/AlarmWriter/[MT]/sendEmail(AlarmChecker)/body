{
  NpcConnectionFactory factory=new NpcConnectionFactory();
  factory.setBoxDirectoryServiceHostName(emailServerUrl);
  factory.setCharset(Charset.forName("UTF-8"));
  factory.setLightWeight(true);
  NpcHessianConnector connector=null;
  try {
    connector=factory.create();
    Object[] params=createSendMailParams(checker);
    InvocationFuture future=connector.invoke(null,"send",params);
    future.await();
    Reply reply=(Reply)future.getReturnValue();
    if (reply instanceof ReturnValue) {
      Object result=((ReturnValue)reply).get();
      logger.debug("MessageId:{}",result);
    }
 else     if (reply instanceof Fault) {
      Fault fault=(Fault)reply;
      logger.warn("Unexpected result:code={}, message={}",fault.getCode(),fault.getMessage());
    }
 else {
      logger.warn("Unexpected clazz({}).",reply.getClass());
    }
  }
 catch (  Exception e) {
    logger.warn(e.getMessage(),e);
  }
 finally {
    if (connector != null) {
      connector.dispose();
    }
  }
}
