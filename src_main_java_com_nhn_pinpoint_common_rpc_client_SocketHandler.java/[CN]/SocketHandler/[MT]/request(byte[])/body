{
  if (bytes == null) {
    throw new NullPointerException("bytes");
  }
  boolean run=isRun();
  if (!run) {
    DefaultFuture<ResponseMessage> closedException=new DefaultFuture<ResponseMessage>();
    closedException.setFailure(new PinpointSocketException("invalid state:" + state.get()));
    return closedException;
  }
  RequestPacket request=new RequestPacket(bytes);
  final Channel channel=this.channel;
  final DefaultFuture<ResponseMessage> messageFuture=this.requestManager.register(request,this.timeoutMillis);
  ChannelFuture write=channel.write(request);
  write.addListener(new ChannelFutureListener(){
    @Override public void operationComplete(    ChannelFuture future) throws Exception {
      if (!future.isSuccess()) {
        Throwable cause=future.getCause();
        messageFuture.setFailure(cause);
      }
    }
  }
);
  return messageFuture;
}
