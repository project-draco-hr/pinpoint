{
  Object obj=getPeekableSpanDataSender().poll();
  short code=serviceType.getCode();
  if (obj == null) {
    throw new AssertionError("No Span. expected: " + toString(code,annotations));
  }
  if (!(obj instanceof Span)) {
    throw new AssertionError("Expected an instance of Span but was " + obj.getClass().getName() + ". expected: "+ toString(code,annotations)+ ", was: "+ obj);
  }
  Span span=(Span)obj;
  if (code != span.getServiceType()) {
    throw new AssertionError("Expected a Span with serviceType[" + code + "] but was ["+ span.getServiceType()+ "]. expected: "+ toString(code,annotations)+ ", was: "+ toString(span));
  }
  List<TAnnotation> actualAnnotations=span.getAnnotations();
  int len=annotations.length;
  int actualLen=actualAnnotations == null ? 0 : actualAnnotations.size();
  if (actualLen != len) {
    throw new AssertionError("Expected a Span with [" + len + "] annotations but was ["+ actualLen+ "]. expected: "+ toString(code,annotations)+ ", was: "+ toString(span));
  }
  for (int i=0; i < len; i++) {
    ExpectedAnnotation expect=annotations[i];
    TAnnotation actual=actualAnnotations.get(i);
    if (expect.getKey() != actual.getKey() || !Objects.equal(expect.getValue(),actual.getValue().getFieldValue())) {
      throw new AssertionError("Expected a Span with " + i + "th annotation ["+ expect+ "] but was ["+ toString(actual)+ "]. expected: "+ toString(code,annotations)+ ", was: "+ toString(span));
    }
  }
}
