{
  ScopePool pool=new ThreadLocalScopePool();
  Scope test=pool.getScope(new DefaultScopeDefinition("test",ScopeDefinition.Type.ATTACHMENT));
  @SuppressWarnings("unchecked") AttachmentThreadLocalScope<Object> scope=(AttachmentThreadLocalScope<Object>)test;
  scope.push();
  scope.push();
  Assert.assertNull(scope.getAttachment());
  Assert.assertEquals(scope.getOrCreate(new AttachmentFactory<Object>(){
    @Override public Object createAttachment(){
      return "test";
    }
  }
),"test");
  scope.pop();
  Assert.assertEquals(scope.getAttachment(),"test");
  Assert.assertTrue(scope.pop() == Scope.ZERO);
  Assert.assertNull(scope.getAttachment());
  Assert.assertEquals("name",scope.getName(),"test");
}
