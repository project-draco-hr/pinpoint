{
  if (!limit) {
synchronized (this) {
      addSubSpan(subSpan);
    }
    limit=checkLimit(subSpan);
  }
 else {
    List<SubSpan> flushData=null;
synchronized (this) {
      if (!addSubSpan(subSpan)) {
        dataSender.send(subSpan);
        return;
      }
      if (storage.size() >= bufferSize) {
        flushData=storage;
        storage=new ArrayList<SubSpan>(bufferSize + RESERVE_BUFFER_SIZE);
      }
    }
    if (flushData != null) {
      dataSender.send(new SpanChunk(flushData));
    }
  }
}
