{
  if (!limit) {
synchronized (this) {
      addSpanEvent(spanEvent);
    }
    limit=checkLimit(spanEvent);
  }
 else {
    List<SpanEvent> flushData=null;
    boolean add;
synchronized (this) {
      add=addSpanEvent(spanEvent);
      if (add && storage.size() >= bufferSize) {
        flushData=storage;
        storage=new ArrayList<SpanEvent>(bufferSize + RESERVE_BUFFER_SIZE);
      }
    }
    if (!add) {
      dataSender.send(spanEvent);
      return;
    }
    if (flushData != null) {
      dataSender.send(new SpanChunk(flushData));
    }
  }
}
