{
  if (sourceApplication == null) {
    throw new NullPointerException("sourceApplication must not be null");
  }
  if (range == null) {
    throw new NullPointerException("range must not be null");
  }
  logger.debug("SelectApplicationMap");
  StopWatch watch=new StopWatch("applicationMapWatch");
  watch.start();
  final Set<Application> callerFoundApplications=new HashSet<Application>();
  final Set<Application> calleeFoundApplications=new HashSet<Application>();
  Set<LinkStatistics> callee=selectCallee(sourceApplication,range,calleeFoundApplications,callerFoundApplications);
  logger.debug("Result of finding callee {}",callee);
  Set<LinkStatistics> caller=selectCaller(sourceApplication,range,calleeFoundApplications,callerFoundApplications);
  logger.debug("Result of finding caller {}",caller);
  Set<LinkStatistics> data=new HashSet<LinkStatistics>(callee.size() + caller.size());
  data.addAll(callee);
  data.addAll(caller);
  ApplicationMap map=new ApplicationMapBuilder().build(new ArrayList<LinkStatistics>(data));
  map.appendResponseTime(range,this.mapResponseDao);
  watch.stop();
  logger.info("Fetch applicationmap elapsed. {}ms",watch.getLastTaskTimeMillis());
  return map;
}
