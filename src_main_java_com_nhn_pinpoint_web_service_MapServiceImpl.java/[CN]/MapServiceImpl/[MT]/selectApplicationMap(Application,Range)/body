{
  if (sourceApplication == null) {
    throw new NullPointerException("sourceApplication must not be null");
  }
  if (range == null) {
    throw new NullPointerException("range must not be null");
  }
  logger.debug("SelectApplicationMap");
  StopWatch watch=new StopWatch("applicationMapWatch");
  watch.start();
  LinkVisitChecker linkVisitChecker=new LinkVisitChecker();
  Set<LinkStatistics> caller=selectCaller(sourceApplication,range,linkVisitChecker);
  logger.debug("Result of finding caller {}",caller);
  Set<LinkStatistics> callee=selectCallee(sourceApplication,range,linkVisitChecker);
  logger.debug("Result of finding callee {}",callee);
  Set<LinkStatistics> data=new HashSet<LinkStatistics>(caller.size() + callee.size());
  data.addAll(caller);
  data.addAll(callee);
  ApplicationMapBuilder builder=new ApplicationMapBuilder(range);
  ApplicationMap map=builder.build(data);
  map.appendResponseTime(range,this.mapResponseDao);
  watch.stop();
  logger.info("Fetch applicationmap elapsed. {}ms",watch.getLastTaskTimeMillis());
  return map;
}
