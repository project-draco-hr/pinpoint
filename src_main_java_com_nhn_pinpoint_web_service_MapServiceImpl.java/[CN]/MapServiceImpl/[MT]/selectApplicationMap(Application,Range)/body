{
  if (sourceApplication == null) {
    throw new NullPointerException("sourceApplication must not be null");
  }
  if (range == null) {
    throw new NullPointerException("range must not be null");
  }
  logger.debug("SelectApplicationMap");
  StopWatch watch=new StopWatch("applicationMapWatch");
  watch.start();
  LinkVisitChecker linkVisitChecker=new LinkVisitChecker();
  LinkDataDuplexMap caller=selectCaller(sourceApplication,range,linkVisitChecker);
  logger.debug("Result of finding caller {}",caller);
  LinkDataDuplexMap callee=selectCallee(sourceApplication,range,linkVisitChecker);
  logger.debug("Result of finding callee {}",callee);
  LinkDataDuplexMap linkDataDuplexMap=new LinkDataDuplexMap();
  linkDataDuplexMap.addLinkStatisticsDataSet(caller);
  linkDataDuplexMap.addLinkStatisticsDataSet(callee);
  ApplicationMapBuilder builder=new ApplicationMapBuilder(range);
  ApplicationMap map=builder.build(linkDataDuplexMap,agentInfoService);
  map.appendResponseTime(range,this.mapResponseDao);
  watch.stop();
  logger.info("Fetch applicationmap elapsed. {}ms",watch.getLastTaskTimeMillis());
  return map;
}
