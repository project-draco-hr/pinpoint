{
  if (!isRun()) {
    return;
  }
  Map<String,Object> properties=this.pinpointSocketFactory.getProperties();
  logger.debug("write HandShakePakcet channel:{}, property:{}..",channel,properties);
  try {
    byte[] payload=ControlMessageEnDeconderUtils.encode(properties);
    ControlHandShakePacket packet=new ControlHandShakePacket(payload);
    final ChannelFuture write=this.channel.write(packet);
    write.addListener(handShakeFailFutureListener);
  }
 catch (  ProtocolException e) {
    logger.warn(e.getMessage(),e);
  }
}
