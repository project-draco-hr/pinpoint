{
  drainStartEntry:   while (true) {
    try {
      if (isShutdown()) {
        break;
      }
      Collection<Object> dtoList=getDrainQueue();
      int drainSize=takeN(dtoList,this.maxDrainSize);
      if (drainSize > 0) {
        sendPacketN(dtoList);
        continue;
      }
      while (true) {
        if (isShutdown()) {
          break;
        }
        Object dto=takeOne();
        if (dto != null) {
          sendPacket(dto);
          continue drainStartEntry;
        }
      }
    }
 catch (    Throwable th) {
      logger.warn("{} doSend->Unexpected Error. Cause:{}",new Object[]{senderName,th.getMessage(),th});
    }
  }
  flushQueue();
}
