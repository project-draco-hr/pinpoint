{
  byte[] buf="foo".getBytes();
  ByteArrayOutputStream out=new ByteArrayOutputStream();
  ByteArrayOutputStreamTransport transport=new ByteArrayOutputStreamTransport(out);
  transport.write(buf,0,buf.length);
  assertTrue(Arrays.equals(buf,out.toByteArray()));
  assertTrue(Arrays.equals(buf,transport.getBuffer()));
  transport.write(buf);
  assertEquals(out.size(),transport.getBufferPosition());
  assertEquals(-1,transport.getBytesRemainingInBuffer());
  transport.flush();
  assertEquals(0,out.size());
  try {
    transport.read(buf,0,1);
    fail("passed unsupported operation");
  }
 catch (  Exception e) {
  }
  try {
    transport.consumeBuffer(1);
    fail("passed unsupported operation");
  }
 catch (  Exception e) {
  }
}
