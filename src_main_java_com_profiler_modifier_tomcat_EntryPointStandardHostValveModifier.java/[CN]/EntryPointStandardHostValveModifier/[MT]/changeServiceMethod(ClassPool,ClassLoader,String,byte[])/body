{
  classPool.insertClassPath(new ByteArrayClassPath(javassistClassName,classfileBuffer));
  try {
    addRequestTracerToCurrentClassLoader(classLoader);
    CtClass cc=classPool.get(javassistClassName);
    CtClass[] params=new CtClass[2];
    params[0]=classPool.getCtClass("org.apache.catalina.connector.Request");
    params[1]=classPool.getCtClass("org.apache.catalina.connector.Response");
    CtMethod serviceMethod=cc.getDeclaredMethod("invoke",params);
    logger.info("Changing invoke method");
    serviceMethod.insertBefore(getInvokeMethodBeforeInsertCode());
    serviceMethod.insertAfter(getInvokeMethodAfterInsertCode());
    CtClass exceptionType=classPool.get("java.lang.Throwable");
    serviceMethod.addCatch(getInvokeMethodCatchInsertCode(),exceptionType);
    byte[] newClassfileBuffer=cc.toBytecode();
    printClassConvertComplete(javassistClassName);
    return newClassfileBuffer;
  }
 catch (  Exception e) {
    logger.error(e.getMessage());
    e.printStackTrace();
  }
  return null;
}
