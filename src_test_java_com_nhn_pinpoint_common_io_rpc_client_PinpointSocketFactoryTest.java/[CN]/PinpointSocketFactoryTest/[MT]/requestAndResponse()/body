{
  PinpointServerSocket ss=new PinpointServerSocket();
  ss.setMessageListener(new TestSeverMessageListener());
  ss.bind("localhost",10234);
  PinpointSocketFactory pinpointSocketFactory=new PinpointSocketFactory();
  try {
    PinpointSocket socket=pinpointSocketFactory.connect("localhost",10234);
    byte[] bytes=TestByteUtils.createRandomByte(20);
    Future<ResponseMessage> request=socket.request(bytes);
    request.await();
    ResponseMessage message=request.getResult();
    Assert.assertArrayEquals(message.getMessage(),bytes);
    socket.close();
  }
  finally {
    pinpointSocketFactory.release();
    ss.close();
  }
}
