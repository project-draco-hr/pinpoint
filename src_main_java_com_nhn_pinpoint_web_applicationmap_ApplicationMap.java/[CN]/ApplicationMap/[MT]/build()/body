{
  if (built)   return this;
  for (  TransactionFlowStatistics stat : data) {
    if (!stat.getFromServiceType().isRpcClient()) {
      addApplication(new Application(makeApplicationId(stat.getFrom(),stat.getFromServiceType()),stat.getFrom(),stat.getFromServiceType(),null));
    }
    if (!stat.getToServiceType().isRpcClient()) {
      addApplication(new Application(makeApplicationId(stat.getTo(),stat.getToServiceType()),stat.getTo(),stat.getToServiceType(),stat.getToHostList()));
    }
    if (!applicationNames.contains(stat.getTo())) {
      addApplication(new Application(makeApplicationId(stat.getTo(),stat.getToServiceType()),stat.getTo(),stat.getToServiceType(),stat.getToHostList()));
    }
  }
  int index=0;
  for (  Entry<String,Application> entry : applications.entrySet()) {
    entry.getValue().setSequence(index++);
  }
  for (  TransactionFlowStatistics stat : data) {
    Application from=findApplication(stat.getFrom(),stat.getFromServiceType());
    Application to=findApplication(stat.getTo(),stat.getToServiceType());
    if (to == null) {
      continue;
    }
    if (to.getServiceType().isRpcClient()) {
      if (!applicationNames.contains(to.getApplicationName())) {
        addRelation(new ApplicationRelation(from,to,stat.getToHostList()));
      }
    }
 else {
      addRelation(new ApplicationRelation(from,to,stat.getToHostList()));
    }
  }
  built=true;
  return this;
}
