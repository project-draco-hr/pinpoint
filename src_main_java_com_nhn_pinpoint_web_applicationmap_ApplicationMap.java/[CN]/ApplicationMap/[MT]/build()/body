{
  if (built)   return this;
  Map<NodeId,Set<AgentInfoBo>> agentMap=rawData.getAgentMap();
  for (  TransactionFlowStatistics stat : rawData) {
    if (!stat.getFromServiceType().isRpcClient()) {
      NodeId id=stat.getFromApplicationId();
      Set<AgentInfoBo> agentSet=agentMap.get(id);
      Application application=new Application(id,stat.getFrom(),stat.getFromServiceType(),null,agentSet);
      logger.info("add Application:{}",application);
      addApplication(application);
    }
    if (!stat.getToServiceType().isRpcClient()) {
      NodeId to=stat.getToApplicationId();
      NodeId from=stat.getFromApplicationId();
      Application application=new Application(to,stat.getTo(),stat.getToServiceType(),stat.getToHostList(),null);
      logger.info("add Application:{}",application);
      addApplication(application);
    }
  }
  indexingApplication();
  for (  TransactionFlowStatistics stat : rawData) {
    NodeId fromApplicationId=stat.getFromApplicationId();
    Application from=findApplication(fromApplicationId);
    NodeId toApplicationId=stat.getToApplicationId();
    Application to=findApplication(toApplicationId);
    if (to == null) {
      continue;
    }
    if (to.getServiceType().isRpcClient()) {
      if (!applicationNames.contains(to.getApplicationName())) {
        addRelation(new ApplicationRelation(from,to,stat.getToHostList()));
      }
    }
 else {
      logger.info("from:{}, to:{}",from,to);
      addRelation(new ApplicationRelation(from,to,stat.getToHostList()));
    }
  }
  for (  Entry<NodeId,Application> app : applications.entrySet()) {
    app.getValue().build();
  }
  built=true;
  return this;
}
