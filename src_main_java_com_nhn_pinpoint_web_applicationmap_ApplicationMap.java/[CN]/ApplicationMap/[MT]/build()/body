{
  if (built)   return this;
  Map<String,Set<AgentInfoBo>> agentMap=rawData.getAgentMap();
  for (  TransactionFlowStatistics stat : rawData) {
    if (!stat.getFromServiceType().isRpcClient()) {
      String id=stat.getFromApplicationId();
      Set<AgentInfoBo> agentSet=agentMap.get(id);
      addApplication(new Application(id,stat.getFrom(),stat.getFromServiceType(),null,agentSet));
    }
    if (!stat.getToServiceType().isRpcClient()) {
      String id=stat.getToApplicationId();
      addApplication(new Application(id,stat.getTo(),stat.getToServiceType(),stat.getToHostList(),null));
    }
  }
  indexingApplication();
  for (  TransactionFlowStatistics stat : rawData) {
    Application from=findApplication(stat.getFromApplicationId());
    Application to=findApplication(stat.getToApplicationId());
    if (to == null) {
      continue;
    }
    if (to.getServiceType().isRpcClient()) {
      if (!applicationNames.contains(to.getApplicationName())) {
        addRelation(new ApplicationRelation(from,to,stat.getToHostList()));
      }
    }
 else {
      addRelation(new ApplicationRelation(from,to,stat.getToHostList()));
    }
  }
  for (  Entry<String,Application> app : applications.entrySet()) {
    app.getValue().build();
  }
  built=true;
  return this;
}
