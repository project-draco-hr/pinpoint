{
  ServiceType serviceType=span.getServiceType();
  String applicationId=span.getApplicationId();
  Application spanKey=new Application(applicationId,serviceType);
  ResponseHistogramSummary responseHistogramSummary=responseHistogramSummaryMap.get(spanKey);
  if (responseHistogramSummary == null) {
    responseHistogramSummary=new ResponseHistogramSummary(spanKey);
    responseHistogramSummaryMap.put(spanKey,responseHistogramSummary);
  }
  ResponseHistogram histogram=new ResponseHistogram(serviceType);
  if (span.getErrCode() != 0) {
    histogram.addElapsedTime(HistogramSchema.ERROR_SLOT_TIME);
  }
 else {
    histogram.addElapsedTime(span.getElapsed());
  }
  responseHistogramSummary.addTotal(histogram);
}
