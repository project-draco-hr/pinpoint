{
  final List<SpanEventBo> spanEventBoList=span.getSpanEventBoList();
  if (CollectionUtils.isEmpty(spanEventBoList)) {
    return;
  }
  final Node srcNode=new Node(span.getApplicationId(),span.getServiceType());
  for (  SpanEventBo spanEvent : spanEventBoList) {
    final String dest=spanEvent.getDestinationId();
    ServiceType destServiceType=spanEvent.getServiceType();
    if (!destServiceType.isRecordStatistics()) {
      continue;
    }
    if (destServiceType.isRpcClient()) {
      if (transactionSpanMap.containsKey(spanEvent.getNextSpanId())) {
        continue;
      }
 else {
        destServiceType=ServiceType.UNKNOWN;
      }
    }
    final NodeId spanEventStatId=new ComplexNodeId(srcNode,new Node(dest,destServiceType));
    TransactionFlowStatistics statistics=statisticsMap.get(spanEventStatId);
    if (statistics == null) {
      Application sourceApplication=new Application(srcNode.getName(),srcNode.getServiceType());
      Application destApplication=new Application(dest,destServiceType);
      statistics=new TransactionFlowStatistics(sourceApplication,destApplication);
    }
    final int slot2=getHistogramSlotTime(spanEvent,destServiceType);
    statistics.addSample(spanEvent.getEndPoint(),destServiceType.getCode(),(short)slot2,1);
    statisticsData.add(statistics);
    statisticsMap.put(spanEventStatId,statistics);
    timeSeriesStore.add(spanEventStatId,span.getStartTime() + spanEvent.getStartElapsed(),slot2,1L,spanEvent.hasException());
    NodeId key=new ComplexNodeId(Node.EMPTY,new Node(spanEvent.getDestinationId(),spanEvent.getServiceType()));
    timeSeriesStore.add(key,span.getCollectorAcceptTime(),slot2,1L,spanEvent.hasException());
  }
}
