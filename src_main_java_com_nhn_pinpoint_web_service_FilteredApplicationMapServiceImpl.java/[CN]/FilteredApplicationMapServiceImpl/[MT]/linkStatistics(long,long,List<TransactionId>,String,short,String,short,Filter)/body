{
  StopWatch watch=new StopWatch();
  watch.start();
  List<List<SpanBo>> transactionList=this.traceDao.selectAllSpans(traceIdSet);
  List<SpanBo> transaction=new ArrayList<SpanBo>();
  for (  List<SpanBo> t : transactionList) {
    if (filter.include(t)) {
      for (      SpanBo span : t) {
        transaction.add(span);
      }
    }
  }
  LinkStatistics statistics=new LinkStatistics(from,to);
  for (  SpanBo span : transaction) {
    if (srcApplicationName.equals(span.getApplicationId()) && srcServiceType == span.getServiceType().getCode()) {
      List<SpanEventBo> spanEventBoList=span.getSpanEventBoList();
      if (spanEventBoList == null) {
        continue;
      }
      for (      SpanEventBo spanEventBo : spanEventBoList) {
        if (destServiceType == spanEventBo.getServiceType().getCode() && destApplicationName.equals(spanEventBo.getDestinationId())) {
          boolean hasException=spanEventBo.hasException();
          statistics.addSample(span.getStartTime() + spanEventBo.getStartElapsed(),spanEventBo.getEndElapsed(),1,hasException);
          break;
        }
      }
    }
  }
  watch.stop();
  logger.info("Fetch link statistics elapsed. {}ms",watch.getLastTaskTimeMillis());
  return statistics;
}
