{
  ResponseHistogramSummary responseHistogramSummary=responseHistogramSummaryMap.get(application);
  if (responseHistogramSummary == null) {
    responseHistogramSummary=new ResponseHistogramSummary(application);
    responseHistogramSummaryMap.put(application,responseHistogramSummary);
  }
  Histogram histogram=new Histogram(application.getServiceType());
  if (span.getErrCode() != 0) {
    histogram.addElapsedTime(HistogramSchema.ERROR_SLOT_TIME);
  }
 else {
    histogram.addElapsedTime(span.getElapsed());
  }
  responseHistogramSummary.addApplicationLevelHistogram(histogram);
  responseHistogramSummary.addAgentLevelHistogram(span.getAgentId(),histogram);
}
