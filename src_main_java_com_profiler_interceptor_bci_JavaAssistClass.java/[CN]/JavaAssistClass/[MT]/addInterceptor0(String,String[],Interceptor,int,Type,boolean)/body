{
  CtBehavior behavior=null;
  try {
    behavior=getBehavior(methodName,args);
  }
 catch (  NotFoundException e) {
    if (interceptor == null) {
      throw new NotFoundInstrumentException(interceptorId + " add fail. Cause:" + e.getMessage(),e);
    }
 else {
      throw new NotFoundInstrumentException(interceptor.getClass().getSimpleName() + " add fail. Cause:" + e.getMessage(),e);
    }
  }
  try {
    if (interceptor != null) {
      interceptorId=InterceptorRegistry.addInterceptor(interceptor);
      if (interceptor instanceof TraceContextSupport) {
        ((TraceContextSupport)interceptor).setTraceContext(instrumentor.getAgent().getTraceContext());
      }
      if (interceptor instanceof ByteCodeMethodDescriptorSupport) {
        setMethodDescriptor(behavior,(ByteCodeMethodDescriptorSupport)interceptor);
      }
      if (interceptor instanceof ApiIdSupport) {
        setApiId(behavior,(ApiIdSupport)interceptor);
      }
    }
 else {
      interceptor=InterceptorRegistry.getInterceptor(interceptorId);
    }
    if (type == Type.auto) {
      if (interceptor instanceof StaticAroundInterceptor) {
        addStaticAroundInterceptor(methodName,interceptorId,behavior,useContextClassLoader);
      }
 else       if (interceptor instanceof StaticBeforeInterceptor) {
        addStaticBeforeInterceptor(methodName,interceptorId,behavior,useContextClassLoader);
      }
 else       if (interceptor instanceof StaticAfterInterceptor) {
        addStaticAfterInterceptor(methodName,interceptorId,behavior,useContextClassLoader);
      }
 else       if (interceptor instanceof SimpleAroundInterceptor) {
        addSimpleAroundInterceptor(methodName,interceptorId,behavior,useContextClassLoader);
      }
 else       if (interceptor instanceof SimpleBeforeInterceptor) {
        addSimpleBeforeInterceptor(methodName,interceptorId,behavior,useContextClassLoader);
      }
 else       if (interceptor instanceof SimpleAfterInterceptor) {
        addSimpleAfterInterceptor(methodName,interceptorId,behavior,useContextClassLoader);
      }
 else {
        throw new IllegalArgumentException("unsupported");
      }
    }
 else     if (type == Type.around && interceptor instanceof StaticAroundInterceptor) {
      addStaticAroundInterceptor(methodName,interceptorId,behavior,useContextClassLoader);
    }
 else     if (type == Type.before && interceptor instanceof StaticBeforeInterceptor) {
      addStaticBeforeInterceptor(methodName,interceptorId,behavior,useContextClassLoader);
    }
 else     if (type == Type.after && interceptor instanceof StaticAfterInterceptor) {
      addStaticAfterInterceptor(methodName,interceptorId,behavior,useContextClassLoader);
    }
 else {
      throw new IllegalArgumentException("unsupported");
    }
    return interceptorId;
  }
 catch (  NotFoundException e) {
    throw new InstrumentException(interceptor.getClass().getSimpleName() + " add fail. Cause:" + e.getMessage(),e);
  }
catch (  CannotCompileException e) {
    throw new InstrumentException(interceptor.getClass().getSimpleName() + "add fail. Cause:" + e.getMessage(),e);
  }
}
