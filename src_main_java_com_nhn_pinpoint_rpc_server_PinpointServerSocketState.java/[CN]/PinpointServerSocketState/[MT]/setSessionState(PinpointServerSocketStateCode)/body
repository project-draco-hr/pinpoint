{
  boolean enable=this.currentState.canChangeState(state);
  if (enable) {
    this.beforeState=this.currentState;
    this.currentState=state;
    return true;
  }
 else   if (PinpointServerSocketStateCode.isFinished(this.currentState)) {
    PinpointServerSocketStateCode checkBefore=this.beforeState;
    PinpointServerSocketStateCode checkCurrent=this.currentState;
    String errorMessage=cannotChangeMessage(checkBefore,checkCurrent,state);
    this.beforeState=this.currentState;
    this.currentState=PinpointServerSocketStateCode.ERROR_ILLEGAL_STATE_CHANGE;
    logger.warn(errorMessage);
    return false;
  }
 else {
    PinpointServerSocketStateCode checkBefore=this.beforeState;
    PinpointServerSocketStateCode checkCurrent=this.currentState;
    String errorMessage=errorMessage(checkBefore,checkCurrent,state);
    this.beforeState=this.currentState;
    this.currentState=PinpointServerSocketStateCode.ERROR_ILLEGAL_STATE_CHANGE;
    logger.warn(errorMessage);
    throw new IllegalStateException(errorMessage);
  }
}
