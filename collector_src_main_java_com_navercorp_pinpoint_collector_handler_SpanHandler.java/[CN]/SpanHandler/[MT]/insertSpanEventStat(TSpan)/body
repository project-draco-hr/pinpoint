{
  final List<TSpanEvent> spanEventList=span.getSpanEventList();
  if (CollectionUtils.isEmpty(spanEventList)) {
    return;
  }
  final ServiceType applicationServiceType=getApplicationServiceType(span);
  logger.debug("handle spanEvent size:{}",spanEventList.size());
  for (  TSpanEvent spanEvent : spanEventList) {
    final ServiceType spanEventType=registry.findServiceType(spanEvent.getServiceType());
    if (!spanEventType.isRecordStatistics()) {
      continue;
    }
    final int elapsed=spanEvent.getEndElapsed();
    final boolean hasException=SpanEventUtils.hasException(spanEvent);
    statisticsHandler.updateCaller(span.getApplicationName(),applicationServiceType,span.getAgentId(),spanEvent.getDestinationId(),spanEventType,spanEvent.getEndPoint(),elapsed,hasException);
    statisticsHandler.updateCallee(spanEvent.getDestinationId(),spanEventType,span.getApplicationName(),applicationServiceType,span.getEndPoint(),elapsed,hasException);
  }
}
