{
  final ServiceType applicationServiceType=getApplicationServiceType(span);
  final boolean isError=span.getErr() != 0;
  int bugCheck=0;
  if (span.getParentSpanId() == -1) {
    statisticsHandler.updateCaller(span.getApplicationName(),ServiceType.USER,span.getAgentId(),span.getApplicationName(),applicationServiceType,span.getAgentId(),span.getElapsed(),isError);
    statisticsHandler.updateCallee(span.getApplicationName(),applicationServiceType,span.getApplicationName(),ServiceType.USER,span.getAgentId(),span.getElapsed(),isError);
    bugCheck++;
  }
  if (span.getParentApplicationName() != null) {
    logger.debug("Received parent application name. {}",span.getParentApplicationName());
    final ServiceType parentApplicationType=registry.findServiceType(span.getParentApplicationType());
    statisticsHandler.updateCallee(span.getApplicationName(),applicationServiceType,span.getParentApplicationName(),parentApplicationType,span.getAgentId(),span.getElapsed(),isError);
    bugCheck++;
  }
  statisticsHandler.updateResponseTime(span.getApplicationName(),applicationServiceType,span.getAgentId(),span.getElapsed(),isError);
  if (bugCheck != 1) {
    logger.warn("ambiguous span found(bug). span:{}",span);
  }
}
