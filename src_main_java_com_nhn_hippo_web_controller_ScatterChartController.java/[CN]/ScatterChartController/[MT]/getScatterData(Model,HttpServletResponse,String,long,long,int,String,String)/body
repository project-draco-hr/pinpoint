{
  StopWatch watch=new StopWatch();
  watch.start("selectScatterData");
  List<Dot> scatterData;
  if (filterText == null) {
    scatterData=scatter.selectScatterData(applicationName,from,to,limit);
    model.addAttribute("queryStart",scatterData.get(0).getTimestamp());
    model.addAttribute("queryEnd",scatterData.get(scatterData.size() - 1).getTimestamp());
  }
 else {
    List<TraceId> traceIds=scatter.selectScatterTraceIdList(applicationName,from,to,limit);
    model.addAttribute("queryStart",((TraceIdWithTime)traceIds.get(0)).getAcceptedTime());
    model.addAttribute("queryEnd",((TraceIdWithTime)traceIds.get(traceIds.size() - 1)).getAcceptedTime());
    scatterData=scatter.selectScatterData(traceIds,applicationName,FilterBuilder.build(filterText));
  }
  watch.stop();
  logger.info("Fetch scatterData time : {}ms",watch.getLastTaskTimeMillis());
  model.addAttribute("scatter",scatterData);
  addResponseHeader(response);
  if (jsonpCallback == null) {
    return "scatter_json";
  }
 else {
    model.addAttribute("callback",jsonpCallback);
    return "scatter_jsonp";
  }
}
