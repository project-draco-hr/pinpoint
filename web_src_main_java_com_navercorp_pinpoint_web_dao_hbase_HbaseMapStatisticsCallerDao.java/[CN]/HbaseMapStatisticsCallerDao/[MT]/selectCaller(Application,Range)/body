{
  if (callerApplication == null) {
    throw new NullPointerException("callerApplication must not be null");
  }
  if (range == null) {
    throw new NullPointerException("range must not be null");
  }
  final TimeWindow timeWindow=new TimeWindow(range,TimeWindowDownSampler.SAMPLER);
  if (tableExists) {
    final Scan scan=createScan(callerApplication,range,HBaseTables.MAP_STATISTICS_CALLEE_VER2_CF_COUNTER);
    ResultsExtractor<LinkDataMap> resultExtractor=new RowMapReduceResultExtractor<>(mapStatisticsCallerMapper,new MapStatisticsTimeWindowReducer(timeWindow));
    LinkDataMap linkDataMap=hbaseOperations2.findParallel(HBaseTables.MAP_STATISTICS_CALLEE_VER2,scan,rowKeyDistributorByHashPrefix,resultExtractor,MAP_STATISTICS_CALLEE_VER2_NUM_PARTITIONS);
    logger.debug("Caller data. {}, {}",linkDataMap,range);
    if (linkDataMap != null && linkDataMap.size() > 0) {
      return linkDataMap;
    }
  }
  if (backwardCompatibility) {
    final Scan scan=createScan(callerApplication,range,HBaseTables.MAP_STATISTICS_CALLEE_CF_COUNTER,HBaseTables.MAP_STATISTICS_CALLEE_CF_VER2_COUNTER);
    ResultsExtractor<LinkDataMap> resultExtractor=new RowMapReduceResultExtractor<>(mapStatisticsCallerMapperBackwardCompatibility,new MapStatisticsTimeWindowReducer(timeWindow));
    LinkDataMap linkDataMap=hbaseOperations2.find(HBaseTables.MAP_STATISTICS_CALLEE,scan,resultExtractor);
    logger.debug("Caller data. {}, {}",linkDataMap,range);
    return linkDataMap != null ? linkDataMap : new LinkDataMap();
  }
 else {
    return new LinkDataMap();
  }
}
