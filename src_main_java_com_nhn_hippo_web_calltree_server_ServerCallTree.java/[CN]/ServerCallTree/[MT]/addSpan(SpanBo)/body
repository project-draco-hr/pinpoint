{
  Server server=new Server(span.getAgentId(),span.getApplicationName(),span.getEndPoint(),span.isTerminal());
  if (server.getId() == null) {
    return;
  }
  if (!servers.containsKey(server.getId())) {
    server.setSequence(servers.size());
    servers.put(server.getId(),server);
  }
  spanIdToServerId.put(String.valueOf(span.getSpanId()),server.getId());
  if (span.getParentSpanId() == -1) {
    businessTransactions.add(span);
  }
 else {
    String from=String.valueOf(span.getParentSpanId());
    String to=String.valueOf(span.getSpanId());
    Server fromServer=servers.get(spanIdToServerId.get(from));
    Server toServer=servers.get(spanIdToServerId.get(to));
    if (fromServer == null) {
      fromServer=servers.get(spanIdToServerId.get(PREFIX_CLIENT + to));
    }
    if (fromServer == null) {
      logger.debug("invalid form server {}",from);
      return;
    }
    ServerRequest serverRequest=new ServerRequest(fromServer,toServer);
    if (serverRequest.isSelfCalled()) {
      return;
    }
    if (ServerRequests.containsKey(serverRequest.getId())) {
      ServerRequests.get(serverRequest.getId()).increaseCallCount();
    }
 else {
      ServerRequests.put(serverRequest.getId(),serverRequest);
    }
  }
}
