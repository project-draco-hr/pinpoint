{
  final PinpointSocketFactory pinpointSocketFactory=new PinpointSocketFactory();
  pinpointSocketFactory.setReconnectDelay(2000);
  PinpointSocket socket=null;
  PinpointServerSocket serverSocket=null;
  try {
    socket=pinpointSocketFactory.scheduledConnect("localhost",10234);
    serverSocket=new PinpointServerSocket();
    serverSocket.setMessageListener(new TestSeverMessageListener());
    serverSocket.bind("localhost",10234);
    Thread.sleep(3000);
    logger.info("request server---------------------------");
    byte[] randomByte=TestByteUtils.createRandomByte(10);
    Future<ResponseMessage> response=socket.request(randomByte);
    response.await();
    ResponseMessage result=response.getResult();
    Assert.assertArrayEquals(randomByte,result.getMessage());
  }
  finally {
    if (socket != null) {
      socket.close();
    }
    pinpointSocketFactory.release();
    if (serverSocket != null) {
      serverSocket.close();
    }
  }
}
