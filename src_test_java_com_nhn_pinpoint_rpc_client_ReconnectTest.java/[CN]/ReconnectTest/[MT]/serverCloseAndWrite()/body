{
  PinpointServerSocket ss=new PinpointServerSocket();
  ss.bind("127.0.0.1",10234);
  PinpointSocketFactory pinpointSocketFactory=new PinpointSocketFactory();
  pinpointSocketFactory.setReconnectDelay(200);
  pinpointSocketFactory.setTimeoutMillis(500);
  try {
    PinpointSocket socket=pinpointSocketFactory.connect("127.0.0.1",10234);
    byte[] randomByte=TestByteUtils.createRandomByte(10);
    ss.close();
    Future<ResponseMessage> response=socket.request(randomByte);
    response.await();
    try {
      response.getResult();
      Assert.fail("expected exception");
    }
 catch (    Exception e) {
      logger.debug("write fail. Caused:{}",e.getMessage(),e);
    }
    Thread.sleep(1000 * 3);
    socket.close();
  }
  finally {
    pinpointSocketFactory.release();
  }
}
