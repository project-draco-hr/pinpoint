{
  limit=LimitUtils.checkRange(limit);
  logger.debug("fetch scatter data FROM={}, TO={}, LIMIT={}, FILTER={}",from,to,limit,filterText);
  StopWatch watch=new StopWatch();
  watch.start("selectScatterData");
  final Range range=Range.createUncheckedRange(from,to);
  List<Dot> scatterData;
  if (filterText == null) {
    scatterData=scatter.selectScatterData(applicationName,range,limit);
    if (scatterData.isEmpty()) {
      model.addAttribute("resultFrom",-1);
      model.addAttribute("resultTo",-1);
    }
 else {
      model.addAttribute("resultFrom",scatterData.get(scatterData.size() - 1).getAcceptedTime());
      model.addAttribute("resultTo",to);
    }
  }
 else {
    final LimitedScanResult<List<TransactionId>> limitedScanResult=flow.selectTraceIdsFromApplicationTraceIndex(applicationName,range,limit);
    final List<TransactionId> traceIdList=limitedScanResult.getScanData();
    logger.trace("submitted transactionId count={}",traceIdList.size());
    SortedSet<TransactionId> traceIdSet=new TreeSet<TransactionId>(traceIdList);
    logger.debug("unified traceIdSet size={}",traceIdSet.size());
    Filter filter=filterBuilder.build(filterText);
    scatterData=scatter.selectScatterData(traceIdSet,applicationName,filter);
    if (traceIdList.isEmpty()) {
      model.addAttribute("resultFrom",-1);
      model.addAttribute("resultTo",-1);
    }
 else {
      model.addAttribute("resultFrom",limitedScanResult.getLimitedTime());
      model.addAttribute("resultTo",to);
      if (logger.isDebugEnabled()) {
        logger.debug("getScatterData range scan(limited:{}) from ~ to:{} ~ {}, limited:{}, filterDataSize:{}",limit,DateUtils.longToDateStr(from),DateUtils.longToDateStr(to),DateUtils.longToDateStr(limitedScanResult.getLimitedTime()),traceIdList.size());
      }
    }
  }
  watch.stop();
  logger.info("Fetch scatterData time : {}ms",watch.getLastTaskTimeMillis());
  model.addAttribute("scatter",scatterData);
  if (jsonpCallback == null) {
    return "scatter_json" + ((version > 1) ? version : "");
  }
 else {
    model.addAttribute("callback",jsonpCallback);
    return "scatter_jsonp" + ((version > 1) ? version : "");
  }
}
