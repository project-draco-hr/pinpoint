{
  StopWatch watch=new StopWatch();
  watch.start("selectScatterData");
  List<Dot> scatterData;
  if (filterText == null) {
    scatterData=scatter.selectScatterData(applicationName,from,to,limit);
    if (scatterData.isEmpty()) {
      model.addAttribute("queryStart",-1);
      model.addAttribute("queryEnd",-1);
    }
 else {
      model.addAttribute("queryStart",from);
      model.addAttribute("queryEnd",scatterData.get(scatterData.size() - 1).getTimestamp());
    }
  }
 else {
    ResultWithMark<List<TransactionId>,Long> traceIdList=flow.selectTraceIdsFromApplicationTraceIndex(applicationName,from,to,limit);
    SortedSet<TransactionId> traceIds=new TreeSet<TransactionId>(traceIdList.getValue());
    scatterData=scatter.selectScatterData(traceIds,applicationName,FilterBuilder.build(filterText));
    if (traceIds.isEmpty()) {
      model.addAttribute("queryStart",-1);
      model.addAttribute("queryEnd",-1);
    }
 else {
      model.addAttribute("queryStart",from);
      model.addAttribute("queryEnd",scatterData.get(scatterData.size() - 1).getTimestamp());
    }
  }
  watch.stop();
  logger.info("Fetch scatterData time : {}ms",watch.getLastTaskTimeMillis());
  model.addAttribute("scatter",scatterData);
  if (jsonpCallback == null) {
    return "scatter_json" + ((version > 1) ? version : "");
  }
 else {
    model.addAttribute("callback",jsonpCallback);
    return "scatter_jsonp" + ((version > 1) ? version : "");
  }
}
