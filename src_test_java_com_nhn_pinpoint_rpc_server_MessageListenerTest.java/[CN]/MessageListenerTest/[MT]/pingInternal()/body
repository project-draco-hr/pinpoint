{
  PinpointServerSocket ss=new PinpointServerSocket();
  ss.bind("127.0.0.1",10234);
  PinpointSocketFactory pinpointSocketFactory=new PinpointSocketFactory();
  pinpointSocketFactory.setAgentProperties(getParams());
  try {
    PinpointSocket socket=pinpointSocketFactory.connect("127.0.0.1",10234,SimpleLoggingMessageListener.LISTENER);
    PinpointSocket socket2=pinpointSocketFactory.connect("127.0.0.1",10234,SimpleLoggingMessageListener.LISTENER);
    Thread.sleep(1000);
    List<ChannelContext> channelContextList=ss.getRegisterAgentChannelContext();
    for (    ChannelContext channelContext : channelContextList) {
      Future future=channelContext.getSocketChannel().sendRequestMessage(new byte[0]);
      future.await();
      System.out.println(future.getResult());
      channelContext.getSocketChannel().sendRequestMessage(new byte[0]);
      channelContext.getSocketChannel().sendRequestMessage(new byte[0]);
      channelContext.getSocketChannel().sendRequestMessage(new byte[0]);
      channelContext.getSocketChannel().sendRequestMessage(new byte[0]);
      channelContext.getSocketChannel().sendMessage(new byte[0]);
    }
    Thread.sleep(1000);
    socket.close();
  }
  finally {
    pinpointSocketFactory.release();
    ss.close();
  }
}
