{
synchronized (lock) {
    if (started) {
      return;
    }
    started=true;
    logger.info("ActiveThreadCountWorker start. applicationName:{}, agentId:{}",agentInfo.getApplicationName(),agentInfo.getAgentId());
    try {
      ClientStreamChannelContext clientStreamChannelContext=agentService.openStream(agentInfo,COMMAND_INSTANCE,messageListener,stateChangeListener);
      if (clientStreamChannelContext == null) {
        defaultFailedResponse.setFail(StreamCode.CONNECTION_NOT_FOUND.name());
        streamConnectionManager.addReconnectJob(agentInfo,COMMAND_INSTANCE,messageListener,stateChangeListener);
      }
 else {
        if (clientStreamChannelContext.getCreateFailPacket() == null) {
          streamChannel=clientStreamChannelContext.getStreamChannel();
        }
 else {
          StreamCreateFailPacket createFailPacket=clientStreamChannelContext.getCreateFailPacket();
          defaultFailedResponse.setFail(createFailPacket.getCode().name());
        }
      }
    }
 catch (    TException exception) {
      defaultFailedResponse.setFail(TRouteResult.NOT_SUPPORTED_REQUEST.name());
    }
  }
}
