{
synchronized (znodeMappingRepository) {
    String zNodePath=znodeMappingRepository.get(channelContext);
    if (!create) {
      return zNodePath;
    }
    if (zNodePath == null) {
      Map<Object,Object> agentProperties=channelContext.getChannelProperties();
      final String applicationName=MapUtils.getString(agentProperties,AgentPropertiesType.APPLICATION_NAME.getName());
      final String agentId=MapUtils.getString(agentProperties,AgentPropertiesType.AGENT_ID.getName());
      if (StringUtils.isEmpty(applicationName) || StringUtils.isEmpty(agentId)) {
        logger.warn("ApplicationName({}) and AgnetId({}) may not be null.",applicationName,agentId);
        return null;
      }
      String path=PINPOINT_PROFILER_CLUSTER_PATH + "/" + applicationName+ "/"+ agentId;
      String zNodeName=createUniqueZnodeName();
      zNodePath=bindingPathAndZnode(path,zNodeName);
      znodeMappingRepository.put(channelContext,zNodePath);
      logger.info("Created Zookeeper UniqPath = {}",zNodePath);
    }
    return zNodePath;
  }
}
