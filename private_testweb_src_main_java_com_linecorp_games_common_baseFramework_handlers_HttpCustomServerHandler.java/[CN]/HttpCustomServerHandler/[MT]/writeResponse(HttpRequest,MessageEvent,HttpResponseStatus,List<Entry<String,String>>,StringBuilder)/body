{
  boolean keepAlive=isKeepAlive(request);
  HttpResponse response=new DefaultHttpResponse(HTTP_1_1,status);
  response.setContent(ChannelBuffers.copiedBuffer(resultContents.toString(),CharsetUtil.UTF_8));
  response.setHeader(CONTENT_TYPE,"application/json");
  response.setHeader(CONTENT_LENGTH,response.getContent().readableBytes());
  if (keepAlive) {
    response.setHeader(CONNECTION,HttpHeaders.Values.KEEP_ALIVE);
  }
  for (  Entry<String,String> header : reponseHeader) {
    response.setHeader(header.getKey(),header.getValue());
  }
  String cookieString=request.getHeader(COOKIE);
  if (cookieString != null) {
    CookieDecoder cookieDecoder=new CookieDecoder();
    Set<Cookie> cookies=cookieDecoder.decode(cookieString);
    if (!cookies.isEmpty()) {
      CookieEncoder cookieEncoder=new CookieEncoder(true);
      for (      Cookie cookie : cookies) {
        cookieEncoder.addCookie(cookie);
        response.addHeader(SET_COOKIE,cookieEncoder.encode());
      }
    }
  }
  ChannelFuture future=e.getChannel().write(response);
  if (!keepAlive) {
    future.addListener(ChannelFutureListener.CLOSE);
  }
 else   future.addListener(ChannelFutureListener.CLOSE_ON_FAILURE);
}
