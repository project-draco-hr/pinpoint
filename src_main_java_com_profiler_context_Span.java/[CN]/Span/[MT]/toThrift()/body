{
  com.profiler.common.dto.thrift.Span span=new com.profiler.common.dto.thrift.Span();
  span.setAgentId(Agent.getInstance().getAgentId());
  span.setStartTime(startTime);
  span.setElapsed((int)(endTime - startTime));
  span.setMostTraceId(traceID.getId().getMostSignificantBits());
  span.setLeastTraceId(traceID.getId().getLeastSignificantBits());
  span.setRpc(rpc);
  span.setServiceName(serviceName);
  span.setServiceType(serviceType.getCode());
  span.setSpanId(traceID.getSpanId());
  span.setParentSpanId(traceID.getParentSpanId());
  span.setEndPoint(endPoint);
  List<com.profiler.common.dto.thrift.Annotation> annotationList=new ArrayList<com.profiler.common.dto.thrift.Annotation>(annotations.size());
  for (  HippoAnnotation a : annotations) {
    annotationList.add(a.toThrift());
  }
  span.setAnnotations(annotationList);
  span.setFlag(traceID.getFlags());
  List<SubSpan> subSpanList=this.getSubSpanList();
  if (subSpanList != null && subSpanList.size() != 0) {
    SubSpan first=null;
    List<com.profiler.common.dto.thrift.SubSpan> tSubSpanList=new ArrayList<com.profiler.common.dto.thrift.SubSpan>(subSpanList.size());
    for (    SubSpan subSpan : subSpanList) {
      com.profiler.common.dto.thrift.SubSpan tSubSpan=subSpan.toThrift(true);
      if (first == null) {
        tSubSpan.setSequence(subSpan.getSequence());
        first=subSpan;
      }
      tSubSpanList.add(tSubSpan);
    }
    span.setSubSpanList(tSubSpanList);
  }
  return span;
}
