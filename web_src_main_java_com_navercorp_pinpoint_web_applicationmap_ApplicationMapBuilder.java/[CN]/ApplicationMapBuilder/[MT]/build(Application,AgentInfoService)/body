{
  NodeList nodeList=new NodeList();
  LinkList emptyLinkList=new LinkList();
  Node node=new Node(application);
  Set<AgentInfo> agentInfos=agentInfoService.getAgentsByApplicationName(application.getName(),range.getTo());
  for (Iterator<AgentInfo> iterator=agentInfos.iterator(); iterator.hasNext(); ) {
    AgentInfo agentInfo=iterator.next();
    if (!isAgentRunning(agentInfo)) {
      iterator.remove();
    }
  }
  if (agentInfos.isEmpty()) {
    return new ApplicationMap(range,nodeList,emptyLinkList);
  }
 else {
    ServerBuilder serverBuilder=new ServerBuilder();
    serverBuilder.addAgentInfo(agentInfos);
    ServerInstanceList serverInstanceList=serverBuilder.build();
    node.setServerInstanceList(serverInstanceList);
    node.setNodeHistogram(new NodeHistogram(application,range));
    nodeList.addNode(node);
    return new ApplicationMap(range,nodeList,emptyLinkList);
  }
}
